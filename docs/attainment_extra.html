<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Professor Adam Dennett FRGS FAcSS, Professor of Urban Analytics, Bartlett Centre for Advanced Spatial Analysis, University College London - a.dennett@ucl.ac.uk">

<title>Attainment Extras – Brighton and Hove Secondary Schools Consultation Evidence</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CE74LTF9B1"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CE74LTF9B1', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Attainment Extras – Brighton and Hove Secondary Schools Consultation Evidence">
<meta property="og:description" content="">
<meta property="og:site_name" content="Brighton and Hove Secondary Schools Consultation Evidence">
<meta name="twitter:title" content="Attainment Extras – Brighton and Hove Secondary Schools Consultation Evidence">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Brighton and Hove Secondary Schools Consultation Evidence</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./absence.html">Analysis</a></li><li class="breadcrumb-item"><a href="./attainment_extra.html">Attainment Extras</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
        <div class="sidebar-tools-collapse tools-wide">
    <a href="https://adamdennett.co.uk" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-person-circle"></i></a>
    <a href="https://twitter.com/adam_dennett" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-collapse-item" href="https://github.com/adamdennett/BH_Schools_Consultation">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-collapse-item" href="https://github.com/adamdennett/BH_Schools_Consultation/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./absence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Let’s Talk About Absence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./attainment_extra.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Attainment Extras</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#disadvantage" id="toc-disadvantage" class="nav-link" data-scroll-target="#disadvantage">Disadvantage</a>
  <ul class="collapse">
  <li><a href="#attainment-8" id="toc-attainment-8" class="nav-link" data-scroll-target="#attainment-8">Attainment 8</a>
  <ul class="collapse">
  <li><a href="#attainment-non-disadvantaged-all" id="toc-attainment-non-disadvantaged-all" class="nav-link" data-scroll-target="#attainment-non-disadvantaged-all">Attainment Non-Disadvantaged All</a></li>
  <li><a href="#attainment-non-disadvantaged-bh-range" id="toc-attainment-non-disadvantaged-bh-range" class="nav-link" data-scroll-target="#attainment-non-disadvantaged-bh-range">Attainment Non-Disadvantaged B&amp;H Range</a></li>
  <li><a href="#attainment-non-disadvantaged-mixed-ranges" id="toc-attainment-non-disadvantaged-mixed-ranges" class="nav-link" data-scroll-target="#attainment-non-disadvantaged-mixed-ranges">Attainment Non-Disadvantaged Mixed Ranges</a></li>
  <li><a href="#attainment-disadvantaged-all" id="toc-attainment-disadvantaged-all" class="nav-link" data-scroll-target="#attainment-disadvantaged-all">Attainment Disadvantaged All</a></li>
  <li><a href="#attainment-disadvantaged-bh-range" id="toc-attainment-disadvantaged-bh-range" class="nav-link" data-scroll-target="#attainment-disadvantaged-bh-range">Attainment Disadvantaged B&amp;H Range</a></li>
  <li><a href="#attainment-disadvantaged-mixed-ranges" id="toc-attainment-disadvantaged-mixed-ranges" class="nav-link" data-scroll-target="#attainment-disadvantaged-mixed-ranges">Attainment Disadvantaged Mixed Ranges</a></li>
  </ul></li>
  <li><a href="#progress-8" id="toc-progress-8" class="nav-link" data-scroll-target="#progress-8">Progress 8</a>
  <ul class="collapse">
  <li><a href="#progress-non-disadvantaged-all" id="toc-progress-non-disadvantaged-all" class="nav-link" data-scroll-target="#progress-non-disadvantaged-all">Progress Non-Disadvantaged All</a></li>
  <li><a href="#progress-non-disadvantaged-bh-range" id="toc-progress-non-disadvantaged-bh-range" class="nav-link" data-scroll-target="#progress-non-disadvantaged-bh-range">Progress Non-Disadvantaged B&amp;H Range</a></li>
  <li><a href="#progress-non-disadvantaged-mixed-ranges" id="toc-progress-non-disadvantaged-mixed-ranges" class="nav-link" data-scroll-target="#progress-non-disadvantaged-mixed-ranges">Progress Non-Disadvantaged Mixed Ranges</a></li>
  <li><a href="#progress-disadvantaged-all" id="toc-progress-disadvantaged-all" class="nav-link" data-scroll-target="#progress-disadvantaged-all">Progress Disadvantaged All</a></li>
  <li><a href="#progress-disadvantaged-bh-range" id="toc-progress-disadvantaged-bh-range" class="nav-link" data-scroll-target="#progress-disadvantaged-bh-range">Progress Disadvantaged B&amp;H Range</a></li>
  <li><a href="#progress-disadvantaged-mixed-ranges" id="toc-progress-disadvantaged-mixed-ranges" class="nav-link" data-scroll-target="#progress-disadvantaged-mixed-ranges">Progress Disadvantaged Mixed Ranges</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#persistent-absence" id="toc-persistent-absence" class="nav-link" data-scroll-target="#persistent-absence">Persistent Absence</a>
  <ul class="collapse">
  <li><a href="#attainment-8-1" id="toc-attainment-8-1" class="nav-link" data-scroll-target="#attainment-8-1">Attainment 8</a>
  <ul class="collapse">
  <li><a href="#attainment-non-disadvantaged-all-1" id="toc-attainment-non-disadvantaged-all-1" class="nav-link" data-scroll-target="#attainment-non-disadvantaged-all-1">Attainment Non-Disadvantaged All</a></li>
  <li><a href="#attainment-non-disadvantaged-bh-range-1" id="toc-attainment-non-disadvantaged-bh-range-1" class="nav-link" data-scroll-target="#attainment-non-disadvantaged-bh-range-1">Attainment Non-Disadvantaged B&amp;H Range</a></li>
  <li><a href="#attainment-non-disadvantaged-mixed-ranges-1" id="toc-attainment-non-disadvantaged-mixed-ranges-1" class="nav-link" data-scroll-target="#attainment-non-disadvantaged-mixed-ranges-1">Attainment Non-Disadvantaged Mixed Ranges</a></li>
  <li><a href="#attainment-disadvantaged-all-1" id="toc-attainment-disadvantaged-all-1" class="nav-link" data-scroll-target="#attainment-disadvantaged-all-1">Attainment Disadvantaged All</a></li>
  <li><a href="#attainment-disadvantaged-bh-range-1" id="toc-attainment-disadvantaged-bh-range-1" class="nav-link" data-scroll-target="#attainment-disadvantaged-bh-range-1">Attainment Disadvantaged B&amp;H Range</a></li>
  <li><a href="#attainment-disadvantaged-mixed-ranges-1" id="toc-attainment-disadvantaged-mixed-ranges-1" class="nav-link" data-scroll-target="#attainment-disadvantaged-mixed-ranges-1">Attainment Disadvantaged Mixed Ranges</a></li>
  </ul></li>
  <li><a href="#progress-8-1" id="toc-progress-8-1" class="nav-link" data-scroll-target="#progress-8-1">Progress 8</a>
  <ul class="collapse">
  <li><a href="#progress-non-disadvantaged-all-1" id="toc-progress-non-disadvantaged-all-1" class="nav-link" data-scroll-target="#progress-non-disadvantaged-all-1">Progress Non-Disadvantaged All</a></li>
  <li><a href="#progress-non-disadvantaged-bh-range-1" id="toc-progress-non-disadvantaged-bh-range-1" class="nav-link" data-scroll-target="#progress-non-disadvantaged-bh-range-1">Progress Non-Disadvantaged B&amp;H Range</a></li>
  <li><a href="#progress-non-disadvantaged-mixed-ranges-1" id="toc-progress-non-disadvantaged-mixed-ranges-1" class="nav-link" data-scroll-target="#progress-non-disadvantaged-mixed-ranges-1">Progress Non-Disadvantaged Mixed Ranges</a></li>
  <li><a href="#progress-disadvantaged-all-1" id="toc-progress-disadvantaged-all-1" class="nav-link" data-scroll-target="#progress-disadvantaged-all-1">Progress Disadvantaged All</a></li>
  <li><a href="#progress-disadvantaged-bh-range-1" id="toc-progress-disadvantaged-bh-range-1" class="nav-link" data-scroll-target="#progress-disadvantaged-bh-range-1">Progress Disadvantaged B&amp;H Range</a></li>
  <li><a href="#progress-disadvantaged-mixed-ranges-1" id="toc-progress-disadvantaged-mixed-ranges-1" class="nav-link" data-scroll-target="#progress-disadvantaged-mixed-ranges-1">Progress Disadvantaged Mixed Ranges</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/adamdennett/BH_Schools_Consultation/blob/main/attainment_extra.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/adamdennett/BH_Schools_Consultation/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./absence.html">Analysis</a></li><li class="breadcrumb-item"><a href="./attainment_extra.html">Attainment Extras</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Attainment Extras</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Professor Adam Dennett FRGS FAcSS, Professor of Urban Analytics, Bartlett Centre for Advanced Spatial Analysis, University College London - a.dennett@ucl.ac.uk </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="summary" class="level1">
<h1>Summary</h1>
<p>The plots below recreate and extend the work that Ben Harper posted on Facebook <a href="https://www.facebook.com/groups/brightonandhoveschoolcatchments/permalink/9017929404990608/">here</a>.</p>
<p>His work - taken alongside this other post <a href="https://www.facebook.com/groups/brightonandhoveschoolcatchments/permalink/9028577260592489/">here</a> where the weakness of the Gorardian association between social mixing and attainment <a href="https://journals.sagepub.com/doi/full/10.1177/2158244018825171">first cited in this paper</a> was demonstrated - was important as it provides strong evidence that for disadvantaged students (those who BHCC have identified as wanting to improve attainment for), no amount of increased or decreased social mixing in schools will make a difference to their progress or attainment at the end of KS4.</p>
<p>Just to be clear. Using data from 2022-23 for all state secondary schools in England, for the range of disadvantage experienced in Brighton and Hove Schools (and we know that levels of disadvantage in the city are likely to increase overall from the Council’s own projections), we find <strong>NO RELATIONSHIP</strong> between the increase or decrease in the total proportion of disadvantaged pupils in those schools and the increase or decrease or both Progress 8 and Attainment 8 scores. <strong>NO RELATIONSHIP</strong>.</p>
<p>There is a weak negative relationship for non-disadvantaged students. This means that through a policy of increased social mixing - even before we try to account for the negative impacts of increased travel which will be used to facilitate the mixing - we can predict that the council might well be successful in reducing the attainment gap in the city, but only through reducing, slightly, the attainment of non-disadvantaged students in those schools where disadvantaged proportions increase. The gap won’t be closed through increasing the attainment of disadvantaged students - this is likely to remain static.</p>
<p>HOWEVER, it is a different story altogether when we look at persistent absence. If you had read my last piece <a href="https://adamdennett.github.io/BH_Schools_Consultation/absence.html">here</a> you might already be guessing where this is going. Yes, there is a STONG RELATIONSHIP between persistent absence and attainment in the range Brighton and Hove experiences. It is closer to a linear relationship for Progress 8 anyway, but also holds for Attainment 8 which is not a linear relationship, but pretty linear for the Brighton and Hove range.</p>
<p>I will therefore repeat what I said before: If Brighton and Hove Council are serious about wanting to improve the attainment of disadvantaged students in the city, they will not achieve this through changing the concentrations of disadvantage in the schools in the city - even if all schools had the ‘city average’ the evidence looking at all schools in England is there would be no benefit for disadvantaged pupils.</p>
<p>Explore the plots below further for more information.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Absence 2022-23 regression analysis</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="do">##All Data downloaded from here</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="do">##https://www.compare-school-performance.service.gov.uk/</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#read in data for every school in the country</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>england_abs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Performancetables_Eng_2022_23"</span>, <span class="st">"2022-2023"</span>, <span class="st">"england_abs.csv"</span>), <span class="at">na =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>england_census <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Performancetables_Eng_2022_23"</span>, <span class="st">"2022-2023"</span>, <span class="st">"england_census.csv"</span>), <span class="at">na =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>england_ks4final <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Performancetables_Eng_2022_23"</span>, <span class="st">"2022-2023"</span>, <span class="st">"england_ks4final.csv"</span>), <span class="at">na =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>))</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>england_school_information <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Performancetables_Eng_2022_23"</span>, <span class="st">"2022-2023"</span>, <span class="st">"england_school_information.csv"</span>), <span class="at">na =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"SUPP"</span>, <span class="st">"NP"</span>, <span class="st">"NE"</span>))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>england_ks4final <span class="ot">&lt;-</span> england_ks4final <span class="sc">%&gt;%</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">URN =</span> <span class="fu">as.character</span>(URN)) <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(TOTPUPS<span class="sc">:</span>PTOTENT_E_COVID_IMPACTED_PTQ_EE, <span class="sc">~</span> <span class="fu">parse_number</span>(<span class="fu">as.character</span>(.))))</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>england_ks4final <span class="ot">&lt;-</span> england_ks4final <span class="sc">%&gt;%</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(URN))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>england_abs <span class="ot">&lt;-</span> england_abs <span class="sc">%&gt;%</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">URN =</span> <span class="fu">as.character</span>(URN))</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>england_census <span class="ot">&lt;-</span> england_census <span class="sc">%&gt;%</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">URN =</span> <span class="fu">as.character</span>(URN))</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>england_school_information <span class="ot">&lt;-</span> england_school_information <span class="sc">%&gt;%</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">URN =</span> <span class="fu">as.character</span>(URN))</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join england_ks4final with england_abs</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>england_school_2022_23 <span class="ot">&lt;-</span> england_ks4final <span class="sc">%&gt;%</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(england_abs, <span class="at">by =</span> <span class="st">"URN"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(england_census, <span class="at">by =</span> <span class="st">"URN"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(england_school_information, <span class="at">by =</span> <span class="st">"URN"</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>data_types <span class="ot">&lt;-</span> <span class="fu">sapply</span>(england_school_2022_23, class)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>england_school_2022_23_meta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Field =</span> <span class="fu">names</span>(data_types), <span class="at">DataType =</span> data_types)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="disadvantage" class="level1">
<h1>Disadvantage</h1>
<section id="attainment-8" class="level2">
<h2 class="anchored" data-anchor-id="attainment-8">Attainment 8</h2>
<section id="attainment-non-disadvantaged-all" class="level3">
<h3 class="anchored" data-anchor-id="attainment-non-disadvantaged-all">Attainment Non-Disadvantaged All</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model for the entire data</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_NFSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> england_school_2022_23_not_special)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_NFSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_NFSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Attainment 8 Non-Disadvantaged vs % School Percentage of </span><span class="sc">\n</span><span class="st">Disadvantaged Students, 2022-23"</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Disadvantaged Students"</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Attainment 8 measure"</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(england_school_2022_23_not_special<span class="sc">$</span>ATT8SCR_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="attainment-non-disadvantaged-bh-range" class="level3">
<h3 class="anchored" data-anchor-id="attainment-non-disadvantaged-bh-range">Attainment Non-Disadvantaged B&amp;H Range</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the subset</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PTFSM6CLA1A <span class="sc">&lt;=</span> max_value)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_NFSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_data)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(subset_data, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_NFSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_NFSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Attainment Non-Disadvantaged 8 vs % Percentage of </span><span class="sc">\n</span><span class="st">Disadvantaged Students, 2022-23"</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Disadvantaged Students"</span>,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Attainment 8 measure"</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(subset_data<span class="sc">$</span>ATT8SCR_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="attainment-non-disadvantaged-mixed-ranges" class="level3">
<h3 class="anchored" data-anchor-id="attainment-non-disadvantaged-mixed-ranges">Attainment Non-Disadvantaged Mixed Ranges</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subsets</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>subset_before <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&lt;</span> min_value)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>subset_after <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;</span> max_value)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>subset_within <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PTFSM6CLA1A <span class="sc">&lt;=</span> max_value)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear models</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>lm_before <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_NFSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_before)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>lm_within <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_NFSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_within)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>lm_after <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_NFSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_after)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate middle x positions for annotations</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>middle_before <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">0</span>, min_value))</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>middle_within <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(min_value, max_value))</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>middle_after <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(max_value, <span class="dv">100</span>))</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with annotations</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_NFSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_NFSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_before, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_within, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_after, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Attainment 8 Non-Disadvantaged vs % Percentage of </span><span class="sc">\n</span><span class="st">Disadvantaged Students, 2022-23"</span>,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"School % Percentage of Disadvantaged Students"</span>,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Attainment 8 measure"</span>,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_before, <span class="at">y =</span> <span class="fu">min</span>(subset_before<span class="sc">$</span>ATT8SCR_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Lower B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_before)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_within, <span class="at">y =</span> <span class="fu">min</span>(subset_within<span class="sc">$</span>ATT8SCR_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"B&amp;H FSM Range</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_within)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_after, <span class="at">y =</span> <span class="fu">min</span>(subset_after<span class="sc">$</span>ATT8SCR_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Higher B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_after)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="attainment-disadvantaged-all" class="level3">
<h3 class="anchored" data-anchor-id="attainment-disadvantaged-all">Attainment Disadvantaged All</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model for the entire data</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_FSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> england_school_2022_23_not_special)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_FSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_FSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Attainment 8 Disadvantaged vs % School Percentage of </span><span class="sc">\n</span><span class="st">Disadvantaged Students, 2022-23"</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Disadvantaged Students"</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Attainment 8 measure"</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(england_school_2022_23_not_special<span class="sc">$</span>ATT8SCR_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="attainment-disadvantaged-bh-range" class="level3">
<h3 class="anchored" data-anchor-id="attainment-disadvantaged-bh-range">Attainment Disadvantaged B&amp;H Range</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the subset</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PTFSM6CLA1A <span class="sc">&lt;=</span> max_value)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_FSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_data)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(subset_data, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_FSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_FSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Attainment Disadvantaged 8 vs % Percentage of </span><span class="sc">\n</span><span class="st">Disadvantaged Students, 2022-23"</span>,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Disadvantaged Students"</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Attainment 8 measure"</span>,</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(subset_data<span class="sc">$</span>ATT8SCR_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="attainment-disadvantaged-mixed-ranges" class="level3">
<h3 class="anchored" data-anchor-id="attainment-disadvantaged-mixed-ranges">Attainment Disadvantaged Mixed Ranges</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subsets</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>subset_before <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&lt;</span> min_value)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>subset_after <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;</span> max_value)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>subset_within <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PTFSM6CLA1A <span class="sc">&lt;=</span> max_value)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear models</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>lm_before <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_FSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_before)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>lm_within <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_FSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_within)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>lm_after <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_FSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_after)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate middle x positions for annotations</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>middle_before <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">0</span>, min_value))</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>middle_within <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(min_value, max_value))</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>middle_after <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(max_value, <span class="dv">100</span>))</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with annotations</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_FSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_FSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_before, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_within, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_after, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Attainment 8 Disadvantaged vs % Percentage of </span><span class="sc">\n</span><span class="st">Disadvantaged Students, 2022-23"</span>,</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"School % Percentage of Disadvantaged Students"</span>,</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Attainment 8 measure"</span>,</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_before, <span class="at">y =</span> <span class="fu">min</span>(subset_before<span class="sc">$</span>ATT8SCR_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Lower B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_before)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_within, <span class="at">y =</span> <span class="fu">min</span>(subset_within<span class="sc">$</span>ATT8SCR_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"B&amp;H FSM Range</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_within)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.75</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_after, <span class="at">y =</span> <span class="fu">min</span>(subset_after<span class="sc">$</span>ATT8SCR_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Higher B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_after)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="progress-8" class="level2">
<h2 class="anchored" data-anchor-id="progress-8">Progress 8</h2>
<section id="progress-non-disadvantaged-all" class="level3">
<h3 class="anchored" data-anchor-id="progress-non-disadvantaged-all">Progress Non-Disadvantaged All</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model for the entire data</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_NFSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> england_school_2022_23_not_special)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_NFSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_NFSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Progress 8 Non-Disadvantaged vs % School Percentage of </span><span class="sc">\n</span><span class="st">Disadvantaged Students, 2022-23"</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Disadvantaged Students"</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Progress 8 measure"</span>,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(england_school_2022_23_not_special<span class="sc">$</span>P8MEA_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="progress-non-disadvantaged-bh-range" class="level3">
<h3 class="anchored" data-anchor-id="progress-non-disadvantaged-bh-range">Progress Non-Disadvantaged B&amp;H Range</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the subset</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PTFSM6CLA1A <span class="sc">&lt;=</span> max_value)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_NFSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_data)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(subset_data, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_NFSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_NFSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Progress 8 Non-Disadvantaged vs % Percentage of </span><span class="sc">\n</span><span class="st">Disadvantaged Students, 2022-23"</span>,</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Disadvantaged Students"</span>,</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Progress 8 measure"</span>,</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(subset_data<span class="sc">$</span>P8MEA_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="progress-non-disadvantaged-mixed-ranges" class="level3">
<h3 class="anchored" data-anchor-id="progress-non-disadvantaged-mixed-ranges">Progress Non-Disadvantaged Mixed Ranges</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subsets</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>subset_before <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&lt;</span> min_value)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>subset_after <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;</span> max_value)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>subset_within <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PTFSM6CLA1A <span class="sc">&lt;=</span> max_value)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear models</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>lm_before <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_NFSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_before)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>lm_within <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_NFSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_within)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>lm_after <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_NFSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_after)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate middle x positions for annotations</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>middle_before <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">0</span>, min_value))</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>middle_within <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(min_value, max_value))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>middle_after <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(max_value, <span class="dv">100</span>))</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with annotations</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_NFSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_NFSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_before, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_within, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_after, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Progress 8 Non-Disadvantaged vs % Percentage of </span><span class="sc">\n</span><span class="st">Disadvantaged Students, 2022-23"</span>,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"School % Percentage of Disadvantaged Students"</span>,</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Progress 8 measure"</span>,</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_before, <span class="at">y =</span> <span class="fu">min</span>(subset_before<span class="sc">$</span>P8MEA_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Lower B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_before)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_within, <span class="at">y =</span> <span class="fu">min</span>(subset_within<span class="sc">$</span>P8MEA_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"B&amp;H FSM Range</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_within)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_after, <span class="at">y =</span> <span class="fu">min</span>(subset_after<span class="sc">$</span>P8MEA_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Higher B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_after)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="progress-disadvantaged-all" class="level3">
<h3 class="anchored" data-anchor-id="progress-disadvantaged-all">Progress Disadvantaged All</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model for the entire data</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_FSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> england_school_2022_23_not_special)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_FSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_FSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Progress 8 Disadvantaged vs % School Percentage of </span><span class="sc">\n</span><span class="st">Disadvantaged Students, 2022-23"</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Disadvantaged Students"</span>,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Progress 8 measure"</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(england_school_2022_23_not_special<span class="sc">$</span>P8MEA_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="progress-disadvantaged-bh-range" class="level3">
<h3 class="anchored" data-anchor-id="progress-disadvantaged-bh-range">Progress Disadvantaged B&amp;H Range</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the subset</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PTFSM6CLA1A <span class="sc">&lt;=</span> max_value)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_FSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_data)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(subset_data, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_FSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_FSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Progress 8 Disadvantaged vs % Percentage of </span><span class="sc">\n</span><span class="st">Disadvantaged Students, 2022-23"</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Disadvantaged Students"</span>,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Progress 8 measure"</span>,</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(subset_data<span class="sc">$</span>P8MEA_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="progress-disadvantaged-mixed-ranges" class="level3">
<h3 class="anchored" data-anchor-id="progress-disadvantaged-mixed-ranges">Progress Disadvantaged Mixed Ranges</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PTFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subsets</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>subset_before <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&lt;</span> min_value)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>subset_after <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;</span> max_value)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>subset_within <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PTFSM6CLA1A <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PTFSM6CLA1A <span class="sc">&lt;=</span> max_value)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear models</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>lm_before <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_FSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_before)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>lm_within <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_FSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_within)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>lm_after <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_FSM6CLA1A <span class="sc">~</span> PTFSM6CLA1A, <span class="at">data =</span> subset_after)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate middle x positions for annotations</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>middle_before <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">0</span>, min_value))</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>middle_within <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(min_value, max_value))</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>middle_after <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(max_value, <span class="dv">100</span>))</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with annotations</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_FSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A)) <span class="sc">+</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_FSM6CLA1A, <span class="at">x =</span> PTFSM6CLA1A, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_before, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_within, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_after, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Progress 8 Disadvantaged vs % Percentage of </span><span class="sc">\n</span><span class="st">Disadvantaged Students, 2022-23"</span>,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"School % Percentage of Disadvantaged Students"</span>,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Progress 8 measure"</span>,</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_before, <span class="at">y =</span> <span class="fu">min</span>(subset_before<span class="sc">$</span>P8MEA_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Lower B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_before)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_within, <span class="at">y =</span> <span class="fu">min</span>(subset_within<span class="sc">$</span>P8MEA_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"B&amp;H FSM Range</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_within)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_after, <span class="at">y =</span> <span class="fu">min</span>(subset_after<span class="sc">$</span>P8MEA_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Higher B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_after)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="persistent-absence" class="level1">
<h1>Persistent Absence</h1>
<section id="attainment-8-1" class="level2">
<h2 class="anchored" data-anchor-id="attainment-8-1">Attainment 8</h2>
<section id="attainment-non-disadvantaged-all-1" class="level3">
<h3 class="anchored" data-anchor-id="attainment-non-disadvantaged-all-1">Attainment Non-Disadvantaged All</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model for the entire data</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_NFSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> england_school_2022_23_not_special)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_NFSM6CLA1A, <span class="at">x =</span> PPERSABS10)) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_NFSM6CLA1A, <span class="at">x =</span> PPERSABS10, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Attainment 8 Non-Disadvantaged vs % School Percentage of </span><span class="sc">\n</span><span class="st">Persistently Absent Students, 2022-23"</span>,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Persistently Absent Students"</span>,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Attainment 8 measure"</span>,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(england_school_2022_23_not_special<span class="sc">$</span>ATT8SCR_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="attainment-non-disadvantaged-bh-range-1" class="level3">
<h3 class="anchored" data-anchor-id="attainment-non-disadvantaged-bh-range-1">Attainment Non-Disadvantaged B&amp;H Range</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the subset</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PPERSABS10 <span class="sc">&lt;=</span> max_value)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_NFSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_data)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(subset_data, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_NFSM6CLA1A, <span class="at">x =</span> PPERSABS10)) <span class="sc">+</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_NFSM6CLA1A, <span class="at">x =</span> PPERSABS10, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Attainment Non-Disadvantaged 8 vs % Percentage of </span><span class="sc">\n</span><span class="st">Persistently Absent Students, 2022-23"</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Persistently Absent Students"</span>,</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Attainment 8 measure"</span>,</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(subset_data<span class="sc">$</span>ATT8SCR_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="attainment-non-disadvantaged-mixed-ranges-1" class="level3">
<h3 class="anchored" data-anchor-id="attainment-non-disadvantaged-mixed-ranges-1">Attainment Non-Disadvantaged Mixed Ranges</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subsets</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>subset_before <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&lt;</span> min_value)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>subset_after <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&gt;</span> max_value)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>subset_within <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PPERSABS10 <span class="sc">&lt;=</span> max_value)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear models</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>lm_before <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_NFSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_before)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>lm_within <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_NFSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_within)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>lm_after <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_NFSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_after)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate middle x positions for annotations</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>middle_before <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">0</span>, min_value))</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>middle_within <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(min_value, max_value))</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>middle_after <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(max_value, <span class="dv">100</span>))</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with annotations</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_NFSM6CLA1A, <span class="at">x =</span> PPERSABS10)) <span class="sc">+</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_NFSM6CLA1A, <span class="at">x =</span> PPERSABS10, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_before, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_within, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_after, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Attainment 8 Non-Disadvantaged vs % Percentage of </span><span class="sc">\n</span><span class="st">Persistently Absent Students, 2022-23"</span>,</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"School % Percentage of Persistently Absent Students"</span>,</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Attainment 8 measure"</span>,</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_before, <span class="at">y =</span> <span class="fu">min</span>(subset_before<span class="sc">$</span>ATT8SCR_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Lower B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_before)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_within, <span class="at">y =</span> <span class="fu">min</span>(subset_within<span class="sc">$</span>ATT8SCR_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"B&amp;H P-Abs Range</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_within)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_after, <span class="at">y =</span> <span class="fu">min</span>(subset_after<span class="sc">$</span>ATT8SCR_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Higher B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_after)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="attainment-disadvantaged-all-1" class="level3">
<h3 class="anchored" data-anchor-id="attainment-disadvantaged-all-1">Attainment Disadvantaged All</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model for the entire data</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_FSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> england_school_2022_23_not_special)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_FSM6CLA1A, <span class="at">x =</span> PPERSABS10)) <span class="sc">+</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_FSM6CLA1A, <span class="at">x =</span> PPERSABS10, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Attainment 8 Disadvantaged vs % School Percentage of </span><span class="sc">\n</span><span class="st">Persistently Absent Students, 2022-23"</span>,</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Persistently Absent Students"</span>,</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Attainment 8 measure"</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(england_school_2022_23_not_special<span class="sc">$</span>ATT8SCR_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="attainment-disadvantaged-bh-range-1" class="level3">
<h3 class="anchored" data-anchor-id="attainment-disadvantaged-bh-range-1">Attainment Disadvantaged B&amp;H Range</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the subset</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PPERSABS10 <span class="sc">&lt;=</span> max_value)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_FSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_data)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(subset_data, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_FSM6CLA1A, <span class="at">x =</span> PPERSABS10)) <span class="sc">+</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_FSM6CLA1A, <span class="at">x =</span> PPERSABS10, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Attainment Disadvantaged 8 vs % Percentage of </span><span class="sc">\n</span><span class="st">Persistently Absent Students, 2022-23"</span>,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Persistently Absent Students"</span>,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Attainment 8 measure"</span>,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(subset_data<span class="sc">$</span>ATT8SCR_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="attainment-disadvantaged-mixed-ranges-1" class="level3">
<h3 class="anchored" data-anchor-id="attainment-disadvantaged-mixed-ranges-1">Attainment Disadvantaged Mixed Ranges</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subsets</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>subset_before <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&lt;</span> min_value)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>subset_after <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&gt;</span> max_value)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>subset_within <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PPERSABS10 <span class="sc">&lt;=</span> max_value)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear models</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>lm_before <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_FSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_before)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>lm_within <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_FSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_within)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>lm_after <span class="ot">&lt;-</span> <span class="fu">lm</span>(ATT8SCR_FSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_after)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate middle x positions for annotations</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>middle_before <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">0</span>, min_value))</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>middle_within <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(min_value, max_value))</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>middle_after <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(max_value, <span class="dv">100</span>))</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with annotations</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_FSM6CLA1A, <span class="at">x =</span> PPERSABS10)) <span class="sc">+</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> ATT8SCR_FSM6CLA1A, <span class="at">x =</span> PPERSABS10, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_before, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_within, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_after, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Attainment 8 Disadvantaged vs % Percentage of </span><span class="sc">\n</span><span class="st">Persistently Absent Students, 2022-23"</span>,</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"School % Percentage of Persistently Absent Students"</span>,</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Attainment 8 measure"</span>,</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_before, <span class="at">y =</span> <span class="fu">min</span>(subset_before<span class="sc">$</span>ATT8SCR_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Lower B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_before)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_within, <span class="at">y =</span> <span class="fu">min</span>(subset_within<span class="sc">$</span>ATT8SCR_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"B&amp;H P-Abs Range</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_within)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_after, <span class="at">y =</span> <span class="fu">min</span>(subset_after<span class="sc">$</span>ATT8SCR_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Higher B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_after)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="progress-8-1" class="level2">
<h2 class="anchored" data-anchor-id="progress-8-1">Progress 8</h2>
<section id="progress-non-disadvantaged-all-1" class="level3">
<h3 class="anchored" data-anchor-id="progress-non-disadvantaged-all-1">Progress Non-Disadvantaged All</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model for the entire data</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_NFSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> england_school_2022_23_not_special)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_NFSM6CLA1A, <span class="at">x =</span> PPERSABS10)) <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_NFSM6CLA1A, <span class="at">x =</span> PPERSABS10, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Progress 8 Non-Disadvantaged vs % School Percentage of </span><span class="sc">\n</span><span class="st">Persistently Absent Students, 2022-23"</span>,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Persistently Absent Students"</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Progress 8 measure"</span>,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(england_school_2022_23_not_special<span class="sc">$</span>P8MEA_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="progress-non-disadvantaged-bh-range-1" class="level3">
<h3 class="anchored" data-anchor-id="progress-non-disadvantaged-bh-range-1">Progress Non-Disadvantaged B&amp;H Range</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the subset</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PPERSABS10 <span class="sc">&lt;=</span> max_value)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_NFSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_data)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(subset_data, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_NFSM6CLA1A, <span class="at">x =</span> PPERSABS10)) <span class="sc">+</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_NFSM6CLA1A, <span class="at">x =</span> PPERSABS10, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Progress 8 Non-Disadvantaged vs % Percentage of </span><span class="sc">\n</span><span class="st">Persistently Absent Students, 2022-23"</span>,</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Persistently Absent Students"</span>,</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Progress 8 measure"</span>,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(subset_data<span class="sc">$</span>P8MEA_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="progress-non-disadvantaged-mixed-ranges-1" class="level3">
<h3 class="anchored" data-anchor-id="progress-non-disadvantaged-mixed-ranges-1">Progress Non-Disadvantaged Mixed Ranges</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subsets</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>subset_before <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&lt;</span> min_value)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>subset_after <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&gt;</span> max_value)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>subset_within <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PPERSABS10 <span class="sc">&lt;=</span> max_value)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear models</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>lm_before <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_NFSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_before)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>lm_within <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_NFSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_within)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>lm_after <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_NFSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_after)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate middle x positions for annotations</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>middle_before <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">0</span>, min_value))</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>middle_within <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(min_value, max_value))</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>middle_after <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(max_value, <span class="dv">100</span>))</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with annotations</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_NFSM6CLA1A, <span class="at">x =</span> PPERSABS10)) <span class="sc">+</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_NFSM6CLA1A, <span class="at">x =</span> PPERSABS10, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_before, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_within, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_after, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Progress 8 Non-Disadvantaged vs % Percentage of </span><span class="sc">\n</span><span class="st">Persistently Absent Students, 2022-23"</span>,</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"School % Percentage of Persistently Absent Students"</span>,</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Progress 8 measure"</span>,</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_before, <span class="at">y =</span> <span class="fu">min</span>(subset_before<span class="sc">$</span>P8MEA_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Lower B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_before)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_within, <span class="at">y =</span> <span class="fu">min</span>(subset_within<span class="sc">$</span>P8MEA_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"B&amp;H P-Abs Range</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_within)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_after, <span class="at">y =</span> <span class="fu">min</span>(subset_after<span class="sc">$</span>P8MEA_NFSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Higher B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_after)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="progress-disadvantaged-all-1" class="level3">
<h3 class="anchored" data-anchor-id="progress-disadvantaged-all-1">Progress Disadvantaged All</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model for the entire data</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_FSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> england_school_2022_23_not_special)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_FSM6CLA1A, <span class="at">x =</span> PPERSABS10)) <span class="sc">+</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_FSM6CLA1A, <span class="at">x =</span> PPERSABS10, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Progress 8 Disadvantaged vs % School Percentage of </span><span class="sc">\n</span><span class="st">Persistently Absent Students, 2022-23"</span>,</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Persistently Absent Students"</span>,</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Progress 8 measure"</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(england_school_2022_23_not_special<span class="sc">$</span>P8MEA_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="progress-disadvantaged-bh-range-1" class="level3">
<h3 class="anchored" data-anchor-id="progress-disadvantaged-bh-range-1">Progress Disadvantaged B&amp;H Range</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the subset</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PPERSABS10 <span class="sc">&lt;=</span> max_value)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_FSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_data)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>coefficients[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> lm_summary<span class="sc">$</span>r.squared</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation text</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>annotation_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Slope:"</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>))</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(subset_data, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_FSM6CLA1A, <span class="at">x =</span> PPERSABS10)) <span class="sc">+</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_FSM6CLA1A, <span class="at">x =</span> PPERSABS10, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Progress 8 Disadvantaged vs % Percentage of </span><span class="sc">\n</span><span class="st">Persistently Absent Students, 2022-23"</span>,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% Percentage of Persistently Absent Students"</span>,</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Progress 8 measure"</span>,</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">80</span>, <span class="at">y =</span> <span class="fu">min</span>(subset_data<span class="sc">$</span>P8MEA_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> annotation_text, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="progress-disadvantaged-mixed-ranges-1" class="level3">
<h3 class="anchored" data-anchor-id="progress-disadvantaged-mixed-ranges-1">Progress Disadvantaged Mixed Ranges</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the min and max values for the subset range</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>min_value <span class="ot">&lt;-</span> <span class="fu">min</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>max_value <span class="ot">&lt;-</span> <span class="fu">max</span>(btn_sub<span class="sc">$</span>PPERSABS10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subsets</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>subset_before <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&lt;</span> min_value)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>subset_after <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&gt;</span> max_value)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>subset_within <span class="ot">&lt;-</span> england_school_2022_23_not_special <span class="sc">%&gt;%</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PPERSABS10 <span class="sc">&gt;=</span> min_value <span class="sc">&amp;</span> PPERSABS10 <span class="sc">&lt;=</span> max_value)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear models</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>lm_before <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_FSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_before)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>lm_within <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_FSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_within)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>lm_after <span class="ot">&lt;-</span> <span class="fu">lm</span>(P8MEA_FSM6CLA1A <span class="sc">~</span> PPERSABS10, <span class="at">data =</span> subset_after)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate middle x positions for annotations</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>middle_before <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">0</span>, min_value))</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>middle_within <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(min_value, max_value))</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>middle_after <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(max_value, <span class="dv">100</span>))</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data with annotations</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(england_school_2022_23_not_special, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_FSM6CLA1A, <span class="at">x =</span> PPERSABS10)) <span class="sc">+</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> btn_sub, <span class="fu">aes</span>(<span class="at">y =</span> P8MEA_FSM6CLA1A, <span class="at">x =</span> PPERSABS10, <span class="at">colour =</span> OFSTEDRATING)) <span class="sc">+</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> max_value, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_before, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_within, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> subset_after, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Progress 8 Disadvantaged vs % Percentage of </span><span class="sc">\n</span><span class="st">Persistently Absent Students, 2022-23"</span>,</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"School % Percentage of Persistently Absent Students"</span>,</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Progress 8 measure"</span>,</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"B&amp;H Schools </span><span class="sc">\n</span><span class="st">Ofsted Rating"</span>) <span class="sc">+</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_before, <span class="at">y =</span> <span class="fu">min</span>(subset_before<span class="sc">$</span>P8MEA_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Lower B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_before)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_before)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_within, <span class="at">y =</span> <span class="fu">min</span>(subset_within<span class="sc">$</span>P8MEA_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"B&amp;H P-Abs Range</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_within)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_within)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> middle_after, <span class="at">y =</span> <span class="fu">min</span>(subset_after<span class="sc">$</span>P8MEA_FSM6CLA1A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Higher B&amp;H</span><span class="sc">\n</span><span class="st">Slope:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">2</span>], <span class="dv">2</span>),</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Intercept:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(lm_after)[<span class="dv">1</span>], <span class="dv">2</span>),</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">R-squared:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(lm_after)<span class="sc">$</span>r.squared, <span class="dv">2</span>)), </span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="attainment_extra_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb27" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Attainment Extras"</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Professor Adam Dennett FRGS FAcSS, Professor of Urban Analytics, Bartlett Centre for Advanced Spatial Analysis, University College London - a.dennett@ucl.ac.uk"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summary</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>The plots below recreate and extend the work that Ben Harper posted on Facebook <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.facebook.com/groups/brightonandhoveschoolcatchments/permalink/9017929404990608/)</span>.</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>His work - taken alongside this other post <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.facebook.com/groups/brightonandhoveschoolcatchments/permalink/9028577260592489/)</span> where the weakness of the Gorardian association between social mixing and attainment <span class="co">[</span><span class="ot">first cited in this paper</span><span class="co">](https://journals.sagepub.com/doi/full/10.1177/2158244018825171)</span> was demonstrated - was important as it provides strong evidence that for disadvantaged students (those who BHCC have identified as wanting to improve attainment for), no amount of increased or decreased social mixing in schools will make a difference to their progress or attainment at the end of KS4.</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>Just to be clear. Using data from 2022-23 for all state secondary schools in England, for the range of disadvantage experienced in Brighton and Hove Schools (and we know that levels of disadvantage in the city are likely to increase overall from the Council's own projections), we find **NO RELATIONSHIP** between the increase or decrease in the total proportion of disadvantaged pupils in those schools and the increase or decrease or both Progress 8 and Attainment 8 scores. **NO RELATIONSHIP**.</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>There is a weak negative relationship for non-disadvantaged students. This means that through a policy of increased social mixing - even before we try to account for the negative impacts of increased travel which will be used to facilitate the mixing - we can predict that the council might well be successful in reducing the attainment gap in the city, but only through reducing, slightly, the attainment of non-disadvantaged students in those schools where disadvantaged proportions increase. The gap won't be closed through increasing the attainment of disadvantaged students - this is likely to remain static.</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>HOWEVER, it is a different story altogether when we look at persistent absence. If you had read my last piece <span class="co">[</span><span class="ot">here</span><span class="co">](https://adamdennett.github.io/BH_Schools_Consultation/absence.html)</span> you might already be guessing where this is going. Yes, there is a STONG RELATIONSHIP between persistent absence and attainment in the range Brighton and Hove experiences. It is closer to a linear relationship for Progress 8 anyway, but also holds for Attainment 8 which is not a linear relationship, but pretty linear for the Brighton and Hove range.</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>I will therefore repeat what I said before: If Brighton and Hove Council are serious about wanting to improve the attainment of disadvantaged students in the city, they will not achieve this through changing the concentrations of disadvantage in the schools in the city - even if all schools had the 'city average' the evidence looking at all schools in England is there would be no benefit for disadvantaged pupils.</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>Explore the plots below further for more information.</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="in">library(here)</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="in">library(janitor)</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf)</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="in">##Absence 2022-23 regression analysis</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="in">##All Data downloaded from here</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="in">##https://www.compare-school-performance.service.gov.uk/</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="in">#read in data for every school in the country</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="in">england_abs &lt;- read_csv(here("data", "Performancetables_Eng_2022_23", "2022-2023", "england_abs.csv"), na = c("", "NA", "SUPP", "NP", "NE"))</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="in">england_census &lt;- read_csv(here("data", "Performancetables_Eng_2022_23", "2022-2023", "england_census.csv"), na = c("", "NA", "SUPP", "NP", "NE"))</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a><span class="in">england_ks4final &lt;- read_csv(here("data", "Performancetables_Eng_2022_23", "2022-2023", "england_ks4final.csv"), na = c("", "NA", "SUPP", "NP", "NE"))</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a><span class="in">england_school_information &lt;- read_csv(here("data", "Performancetables_Eng_2022_23", "2022-2023", "england_school_information.csv"), na = c("", "NA", "SUPP", "NP", "NE"))</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a><span class="in">england_ks4final &lt;- england_ks4final %&gt;%</span></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(URN = as.character(URN)) %&gt;%</span></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(TOTPUPS:PTOTENT_E_COVID_IMPACTED_PTQ_EE, ~ parse_number(as.character(.))))</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a><span class="in">england_ks4final &lt;- england_ks4final %&gt;%</span></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(URN))</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a><span class="in">england_abs &lt;- england_abs %&gt;%</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(URN = as.character(URN))</span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a><span class="in">england_census &lt;- england_census %&gt;%</span></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(URN = as.character(URN))</span></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a><span class="in">england_school_information &lt;- england_school_information %&gt;%</span></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(URN = as.character(URN))</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a><span class="in"># Left join england_ks4final with england_abs</span></span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a><span class="in">england_school_2022_23 &lt;- england_ks4final %&gt;%</span></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(england_abs, by = "URN") %&gt;%</span></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(england_census, by = "URN") %&gt;%</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(england_school_information, by = "URN")</span></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a><span class="in">data_types &lt;- sapply(england_school_2022_23, class)</span></span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a><span class="in">england_school_2022_23_meta &lt;- data.frame(Field = names(data_types), DataType = data_types)</span></span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a><span class="in">#all england schools</span></span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a><span class="in">edubase_schools &lt;- read_csv("https://www.dropbox.com/scl/fi/fhzafgt27v30lmmuo084y/edubasealldata20241003.csv?rlkey=uorw43s44hnw5k9js3z0ksuuq&amp;raw=1") %&gt;% </span></span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a><span class="in">  clean_names() %&gt;% </span></span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(phase_of_education_name == "Secondary") %&gt;% </span></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(establishment_status_name == "Open") %&gt;% </span></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(urn = as.character(urn))</span></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a><span class="in">#read in Brighton Secondary Schools Data</span></span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a><span class="in">brighton_sec_schools &lt;- read_csv("https://www.dropbox.com/scl/fi/fhzafgt27v30lmmuo084y/edubasealldata20241003.csv?rlkey=uorw43s44hnw5k9js3z0ksuuq&amp;raw=1") %&gt;% </span></span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a><span class="in">  clean_names() %&gt;% </span></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(la_name == "Brighton and Hove") %&gt;% </span></span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(phase_of_education_name == "Secondary") %&gt;% </span></span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(establishment_status_name == "Open") %&gt;%</span></span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a><span class="in">  st_as_sf(., coords = c("easting", "northing")) %&gt;% </span></span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_crs(27700)</span></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a><span class="in">btn_urn_list &lt;- brighton_sec_schools %&gt;% </span></span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a><span class="in">  select(urn) </span></span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggrepel)</span></span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a><span class="in">btn_sub &lt;- england_school_2022_23 %&gt;%</span></span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(URN %in% btn_urn_list$urn)</span></span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a><span class="in">#P8_BANDING</span></span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a><span class="in">england_school_2022_23_not_special &lt;- england_school_2022_23 %&gt;%</span></span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(MINORGROUP != "Special school")</span></span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a><span class="in">eng_sch_2022_23_not_special_plus &lt;- england_school_2022_23_not_special %&gt;% left_join(</span></span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a><span class="in">  edubase_schools, by = join_by(URN == urn)</span></span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a><span class="fu"># Disadvantage</span></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a><span class="fu">## Attainment 8</span></span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attainment Non-Disadvantaged All</span></span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model for the entire data</span></span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(ATT8SCR_NFSM6CLA1A ~ PTFSM6CLA1A, data = england_school_2022_23_not_special)</span></span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-127"><a href="#cb27-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-128"><a href="#cb27-128" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-131"><a href="#cb27-131" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-132"><a href="#cb27-132" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = ATT8SCR_NFSM6CLA1A, x = PTFSM6CLA1A)) +</span></span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = ATT8SCR_NFSM6CLA1A, x = PTFSM6CLA1A, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-135"><a href="#cb27-135" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-136"><a href="#cb27-136" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-137"><a href="#cb27-137" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-138"><a href="#cb27-138" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Attainment 8 Non-Disadvantaged vs % School Percentage of \nDisadvantaged Students, 2022-23",</span></span>
<span id="cb27-139"><a href="#cb27-139" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Disadvantaged Students",</span></span>
<span id="cb27-140"><a href="#cb27-140" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Attainment 8 measure",</span></span>
<span id="cb27-141"><a href="#cb27-141" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-142"><a href="#cb27-142" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-143"><a href="#cb27-143" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-144"><a href="#cb27-144" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(england_school_2022_23_not_special$ATT8SCR_NFSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-145"><a href="#cb27-145" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-146"><a href="#cb27-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-147"><a href="#cb27-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-148"><a href="#cb27-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-149"><a href="#cb27-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-150"><a href="#cb27-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-151"><a href="#cb27-151" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attainment Non-Disadvantaged B&amp;H Range</span></span>
<span id="cb27-152"><a href="#cb27-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-153"><a href="#cb27-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-154"><a href="#cb27-154" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-155"><a href="#cb27-155" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-156"><a href="#cb27-156" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-157"><a href="#cb27-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-158"><a href="#cb27-158" aria-hidden="true" tabindex="-1"></a><span class="in"># Create the subset</span></span>
<span id="cb27-159"><a href="#cb27-159" aria-hidden="true" tabindex="-1"></a><span class="in">subset_data &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-160"><a href="#cb27-160" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &gt;= min_value &amp; PTFSM6CLA1A &lt;= max_value)</span></span>
<span id="cb27-161"><a href="#cb27-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-162"><a href="#cb27-162" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model</span></span>
<span id="cb27-163"><a href="#cb27-163" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(ATT8SCR_NFSM6CLA1A ~ PTFSM6CLA1A, data = subset_data)</span></span>
<span id="cb27-164"><a href="#cb27-164" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-165"><a href="#cb27-165" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-166"><a href="#cb27-166" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-167"><a href="#cb27-167" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-168"><a href="#cb27-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-169"><a href="#cb27-169" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-170"><a href="#cb27-170" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-171"><a href="#cb27-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-172"><a href="#cb27-172" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-173"><a href="#cb27-173" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(subset_data, aes(y = ATT8SCR_NFSM6CLA1A, x = PTFSM6CLA1A)) +</span></span>
<span id="cb27-174"><a href="#cb27-174" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-175"><a href="#cb27-175" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = ATT8SCR_NFSM6CLA1A, x = PTFSM6CLA1A, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-176"><a href="#cb27-176" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-177"><a href="#cb27-177" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-178"><a href="#cb27-178" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-179"><a href="#cb27-179" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Attainment Non-Disadvantaged 8 vs % Percentage of \nDisadvantaged Students, 2022-23",</span></span>
<span id="cb27-180"><a href="#cb27-180" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Disadvantaged Students",</span></span>
<span id="cb27-181"><a href="#cb27-181" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Attainment 8 measure",</span></span>
<span id="cb27-182"><a href="#cb27-182" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-183"><a href="#cb27-183" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-184"><a href="#cb27-184" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-185"><a href="#cb27-185" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(subset_data$ATT8SCR_NFSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-186"><a href="#cb27-186" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-187"><a href="#cb27-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-188"><a href="#cb27-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-189"><a href="#cb27-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-190"><a href="#cb27-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-191"><a href="#cb27-191" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attainment Non-Disadvantaged Mixed Ranges</span></span>
<span id="cb27-192"><a href="#cb27-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-193"><a href="#cb27-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-194"><a href="#cb27-194" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-195"><a href="#cb27-195" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-196"><a href="#cb27-196" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-197"><a href="#cb27-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-198"><a href="#cb27-198" aria-hidden="true" tabindex="-1"></a><span class="in"># Create subsets</span></span>
<span id="cb27-199"><a href="#cb27-199" aria-hidden="true" tabindex="-1"></a><span class="in">subset_before &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-200"><a href="#cb27-200" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &lt; min_value)</span></span>
<span id="cb27-201"><a href="#cb27-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-202"><a href="#cb27-202" aria-hidden="true" tabindex="-1"></a><span class="in">subset_after &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-203"><a href="#cb27-203" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &gt; max_value)</span></span>
<span id="cb27-204"><a href="#cb27-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-205"><a href="#cb27-205" aria-hidden="true" tabindex="-1"></a><span class="in">subset_within &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-206"><a href="#cb27-206" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &gt;= min_value &amp; PTFSM6CLA1A &lt;= max_value)</span></span>
<span id="cb27-207"><a href="#cb27-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-208"><a href="#cb27-208" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit linear models</span></span>
<span id="cb27-209"><a href="#cb27-209" aria-hidden="true" tabindex="-1"></a><span class="in">lm_before &lt;- lm(ATT8SCR_NFSM6CLA1A ~ PTFSM6CLA1A, data = subset_before)</span></span>
<span id="cb27-210"><a href="#cb27-210" aria-hidden="true" tabindex="-1"></a><span class="in">lm_within &lt;- lm(ATT8SCR_NFSM6CLA1A ~ PTFSM6CLA1A, data = subset_within)</span></span>
<span id="cb27-211"><a href="#cb27-211" aria-hidden="true" tabindex="-1"></a><span class="in">lm_after &lt;- lm(ATT8SCR_NFSM6CLA1A ~ PTFSM6CLA1A, data = subset_after)</span></span>
<span id="cb27-212"><a href="#cb27-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-213"><a href="#cb27-213" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate middle x positions for annotations</span></span>
<span id="cb27-214"><a href="#cb27-214" aria-hidden="true" tabindex="-1"></a><span class="in">middle_before &lt;- mean(c(0, min_value))</span></span>
<span id="cb27-215"><a href="#cb27-215" aria-hidden="true" tabindex="-1"></a><span class="in">middle_within &lt;- mean(c(min_value, max_value))</span></span>
<span id="cb27-216"><a href="#cb27-216" aria-hidden="true" tabindex="-1"></a><span class="in">middle_after &lt;- mean(c(max_value, 100))</span></span>
<span id="cb27-217"><a href="#cb27-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-218"><a href="#cb27-218" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with annotations</span></span>
<span id="cb27-219"><a href="#cb27-219" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = ATT8SCR_NFSM6CLA1A, x = PTFSM6CLA1A)) +</span></span>
<span id="cb27-220"><a href="#cb27-220" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-221"><a href="#cb27-221" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = ATT8SCR_NFSM6CLA1A, x = PTFSM6CLA1A, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-222"><a href="#cb27-222" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-223"><a href="#cb27-223" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-224"><a href="#cb27-224" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_before, method = "lm", se = TRUE, color = "red", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-225"><a href="#cb27-225" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_within, method = "lm", se = TRUE, color = "green", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-226"><a href="#cb27-226" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_after, method = "lm", se = TRUE, color = "purple", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-227"><a href="#cb27-227" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Attainment 8 Non-Disadvantaged vs % Percentage of \nDisadvantaged Students, 2022-23",</span></span>
<span id="cb27-228"><a href="#cb27-228" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "School % Percentage of Disadvantaged Students",</span></span>
<span id="cb27-229"><a href="#cb27-229" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Attainment 8 measure",</span></span>
<span id="cb27-230"><a href="#cb27-230" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-231"><a href="#cb27-231" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-232"><a href="#cb27-232" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-233"><a href="#cb27-233" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_before, y = min(subset_before$ATT8SCR_NFSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-234"><a href="#cb27-234" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Lower B&amp;H\nSlope:", round(coef(lm_before)[2], 2),</span></span>
<span id="cb27-235"><a href="#cb27-235" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_before)[1], 2),</span></span>
<span id="cb27-236"><a href="#cb27-236" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_before)$r.squared, 2)), </span></span>
<span id="cb27-237"><a href="#cb27-237" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 0, size = 3) +</span></span>
<span id="cb27-238"><a href="#cb27-238" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_within, y = min(subset_within$ATT8SCR_NFSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-239"><a href="#cb27-239" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("B&amp;H FSM Range\nSlope:", round(coef(lm_within)[2], 2),</span></span>
<span id="cb27-240"><a href="#cb27-240" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_within)[1], 2),</span></span>
<span id="cb27-241"><a href="#cb27-241" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_within)$r.squared, 2)), </span></span>
<span id="cb27-242"><a href="#cb27-242" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3) +</span></span>
<span id="cb27-243"><a href="#cb27-243" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_after, y = min(subset_after$ATT8SCR_NFSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-244"><a href="#cb27-244" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Higher B&amp;H\nSlope:", round(coef(lm_after)[2], 2),</span></span>
<span id="cb27-245"><a href="#cb27-245" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_after)[1], 2),</span></span>
<span id="cb27-246"><a href="#cb27-246" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_after)$r.squared, 2)), </span></span>
<span id="cb27-247"><a href="#cb27-247" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3)</span></span>
<span id="cb27-248"><a href="#cb27-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-249"><a href="#cb27-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-250"><a href="#cb27-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-251"><a href="#cb27-251" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attainment Disadvantaged All</span></span>
<span id="cb27-252"><a href="#cb27-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-253"><a href="#cb27-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-254"><a href="#cb27-254" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-255"><a href="#cb27-255" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-256"><a href="#cb27-256" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-257"><a href="#cb27-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-258"><a href="#cb27-258" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model for the entire data</span></span>
<span id="cb27-259"><a href="#cb27-259" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(ATT8SCR_FSM6CLA1A ~ PTFSM6CLA1A, data = england_school_2022_23_not_special)</span></span>
<span id="cb27-260"><a href="#cb27-260" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-261"><a href="#cb27-261" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-262"><a href="#cb27-262" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-263"><a href="#cb27-263" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-264"><a href="#cb27-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-265"><a href="#cb27-265" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-266"><a href="#cb27-266" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-267"><a href="#cb27-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-268"><a href="#cb27-268" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-269"><a href="#cb27-269" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = ATT8SCR_FSM6CLA1A, x = PTFSM6CLA1A)) +</span></span>
<span id="cb27-270"><a href="#cb27-270" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-271"><a href="#cb27-271" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = ATT8SCR_FSM6CLA1A, x = PTFSM6CLA1A, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-272"><a href="#cb27-272" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-273"><a href="#cb27-273" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-274"><a href="#cb27-274" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-275"><a href="#cb27-275" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Attainment 8 Disadvantaged vs % School Percentage of \nDisadvantaged Students, 2022-23",</span></span>
<span id="cb27-276"><a href="#cb27-276" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Disadvantaged Students",</span></span>
<span id="cb27-277"><a href="#cb27-277" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Attainment 8 measure",</span></span>
<span id="cb27-278"><a href="#cb27-278" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-279"><a href="#cb27-279" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-280"><a href="#cb27-280" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-281"><a href="#cb27-281" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(england_school_2022_23_not_special$ATT8SCR_FSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-282"><a href="#cb27-282" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-283"><a href="#cb27-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-284"><a href="#cb27-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-285"><a href="#cb27-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-286"><a href="#cb27-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-287"><a href="#cb27-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-288"><a href="#cb27-288" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attainment Disadvantaged B&amp;H Range</span></span>
<span id="cb27-289"><a href="#cb27-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-290"><a href="#cb27-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-291"><a href="#cb27-291" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-292"><a href="#cb27-292" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-293"><a href="#cb27-293" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-294"><a href="#cb27-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-295"><a href="#cb27-295" aria-hidden="true" tabindex="-1"></a><span class="in"># Create the subset</span></span>
<span id="cb27-296"><a href="#cb27-296" aria-hidden="true" tabindex="-1"></a><span class="in">subset_data &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-297"><a href="#cb27-297" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &gt;= min_value &amp; PTFSM6CLA1A &lt;= max_value)</span></span>
<span id="cb27-298"><a href="#cb27-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-299"><a href="#cb27-299" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model</span></span>
<span id="cb27-300"><a href="#cb27-300" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(ATT8SCR_FSM6CLA1A ~ PTFSM6CLA1A, data = subset_data)</span></span>
<span id="cb27-301"><a href="#cb27-301" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-302"><a href="#cb27-302" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-303"><a href="#cb27-303" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-304"><a href="#cb27-304" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-305"><a href="#cb27-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-306"><a href="#cb27-306" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-307"><a href="#cb27-307" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-308"><a href="#cb27-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-309"><a href="#cb27-309" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-310"><a href="#cb27-310" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(subset_data, aes(y = ATT8SCR_FSM6CLA1A, x = PTFSM6CLA1A)) +</span></span>
<span id="cb27-311"><a href="#cb27-311" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-312"><a href="#cb27-312" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = ATT8SCR_FSM6CLA1A, x = PTFSM6CLA1A, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-313"><a href="#cb27-313" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-314"><a href="#cb27-314" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-315"><a href="#cb27-315" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-316"><a href="#cb27-316" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Attainment Disadvantaged 8 vs % Percentage of \nDisadvantaged Students, 2022-23",</span></span>
<span id="cb27-317"><a href="#cb27-317" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Disadvantaged Students",</span></span>
<span id="cb27-318"><a href="#cb27-318" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Attainment 8 measure",</span></span>
<span id="cb27-319"><a href="#cb27-319" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-320"><a href="#cb27-320" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-321"><a href="#cb27-321" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-322"><a href="#cb27-322" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(subset_data$ATT8SCR_FSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-323"><a href="#cb27-323" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-324"><a href="#cb27-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-325"><a href="#cb27-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-326"><a href="#cb27-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-327"><a href="#cb27-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-328"><a href="#cb27-328" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attainment Disadvantaged Mixed Ranges</span></span>
<span id="cb27-329"><a href="#cb27-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-330"><a href="#cb27-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-331"><a href="#cb27-331" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-332"><a href="#cb27-332" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-333"><a href="#cb27-333" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-334"><a href="#cb27-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-335"><a href="#cb27-335" aria-hidden="true" tabindex="-1"></a><span class="in"># Create subsets</span></span>
<span id="cb27-336"><a href="#cb27-336" aria-hidden="true" tabindex="-1"></a><span class="in">subset_before &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-337"><a href="#cb27-337" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &lt; min_value)</span></span>
<span id="cb27-338"><a href="#cb27-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-339"><a href="#cb27-339" aria-hidden="true" tabindex="-1"></a><span class="in">subset_after &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-340"><a href="#cb27-340" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &gt; max_value)</span></span>
<span id="cb27-341"><a href="#cb27-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-342"><a href="#cb27-342" aria-hidden="true" tabindex="-1"></a><span class="in">subset_within &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-343"><a href="#cb27-343" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &gt;= min_value &amp; PTFSM6CLA1A &lt;= max_value)</span></span>
<span id="cb27-344"><a href="#cb27-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-345"><a href="#cb27-345" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit linear models</span></span>
<span id="cb27-346"><a href="#cb27-346" aria-hidden="true" tabindex="-1"></a><span class="in">lm_before &lt;- lm(ATT8SCR_FSM6CLA1A ~ PTFSM6CLA1A, data = subset_before)</span></span>
<span id="cb27-347"><a href="#cb27-347" aria-hidden="true" tabindex="-1"></a><span class="in">lm_within &lt;- lm(ATT8SCR_FSM6CLA1A ~ PTFSM6CLA1A, data = subset_within)</span></span>
<span id="cb27-348"><a href="#cb27-348" aria-hidden="true" tabindex="-1"></a><span class="in">lm_after &lt;- lm(ATT8SCR_FSM6CLA1A ~ PTFSM6CLA1A, data = subset_after)</span></span>
<span id="cb27-349"><a href="#cb27-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-350"><a href="#cb27-350" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate middle x positions for annotations</span></span>
<span id="cb27-351"><a href="#cb27-351" aria-hidden="true" tabindex="-1"></a><span class="in">middle_before &lt;- mean(c(0, min_value))</span></span>
<span id="cb27-352"><a href="#cb27-352" aria-hidden="true" tabindex="-1"></a><span class="in">middle_within &lt;- mean(c(min_value, max_value))</span></span>
<span id="cb27-353"><a href="#cb27-353" aria-hidden="true" tabindex="-1"></a><span class="in">middle_after &lt;- mean(c(max_value, 100))</span></span>
<span id="cb27-354"><a href="#cb27-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-355"><a href="#cb27-355" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with annotations</span></span>
<span id="cb27-356"><a href="#cb27-356" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = ATT8SCR_FSM6CLA1A, x = PTFSM6CLA1A)) +</span></span>
<span id="cb27-357"><a href="#cb27-357" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-358"><a href="#cb27-358" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = ATT8SCR_FSM6CLA1A, x = PTFSM6CLA1A, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-359"><a href="#cb27-359" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-360"><a href="#cb27-360" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-361"><a href="#cb27-361" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_before, method = "lm", se = TRUE, color = "red", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-362"><a href="#cb27-362" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_within, method = "lm", se = TRUE, color = "green", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-363"><a href="#cb27-363" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_after, method = "lm", se = TRUE, color = "purple", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-364"><a href="#cb27-364" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Attainment 8 Disadvantaged vs % Percentage of \nDisadvantaged Students, 2022-23",</span></span>
<span id="cb27-365"><a href="#cb27-365" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "School % Percentage of Disadvantaged Students",</span></span>
<span id="cb27-366"><a href="#cb27-366" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Attainment 8 measure",</span></span>
<span id="cb27-367"><a href="#cb27-367" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-368"><a href="#cb27-368" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-369"><a href="#cb27-369" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-370"><a href="#cb27-370" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_before, y = min(subset_before$ATT8SCR_FSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-371"><a href="#cb27-371" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Lower B&amp;H\nSlope:", round(coef(lm_before)[2], 2),</span></span>
<span id="cb27-372"><a href="#cb27-372" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_before)[1], 2),</span></span>
<span id="cb27-373"><a href="#cb27-373" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_before)$r.squared, 2)), </span></span>
<span id="cb27-374"><a href="#cb27-374" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3) +</span></span>
<span id="cb27-375"><a href="#cb27-375" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_within, y = min(subset_within$ATT8SCR_FSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-376"><a href="#cb27-376" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("B&amp;H FSM Range\nSlope:", round(coef(lm_within)[2], 2),</span></span>
<span id="cb27-377"><a href="#cb27-377" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_within)[1], 2),</span></span>
<span id="cb27-378"><a href="#cb27-378" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_within)$r.squared, 2)), </span></span>
<span id="cb27-379"><a href="#cb27-379" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.75, vjust = -3, size = 3) +</span></span>
<span id="cb27-380"><a href="#cb27-380" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_after, y = min(subset_after$ATT8SCR_FSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-381"><a href="#cb27-381" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Higher B&amp;H\nSlope:", round(coef(lm_after)[2], 2),</span></span>
<span id="cb27-382"><a href="#cb27-382" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_after)[1], 2),</span></span>
<span id="cb27-383"><a href="#cb27-383" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_after)$r.squared, 2)), </span></span>
<span id="cb27-384"><a href="#cb27-384" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = -2.5, size = 3)</span></span>
<span id="cb27-385"><a href="#cb27-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-386"><a href="#cb27-386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-387"><a href="#cb27-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-388"><a href="#cb27-388" aria-hidden="true" tabindex="-1"></a><span class="fu">## Progress 8</span></span>
<span id="cb27-389"><a href="#cb27-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-390"><a href="#cb27-390" aria-hidden="true" tabindex="-1"></a><span class="fu">### Progress Non-Disadvantaged All</span></span>
<span id="cb27-391"><a href="#cb27-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-392"><a href="#cb27-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-393"><a href="#cb27-393" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-394"><a href="#cb27-394" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-395"><a href="#cb27-395" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-396"><a href="#cb27-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-397"><a href="#cb27-397" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model for the entire data</span></span>
<span id="cb27-398"><a href="#cb27-398" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(P8MEA_NFSM6CLA1A ~ PTFSM6CLA1A, data = england_school_2022_23_not_special)</span></span>
<span id="cb27-399"><a href="#cb27-399" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-400"><a href="#cb27-400" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-401"><a href="#cb27-401" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-402"><a href="#cb27-402" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-403"><a href="#cb27-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-404"><a href="#cb27-404" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-405"><a href="#cb27-405" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-406"><a href="#cb27-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-407"><a href="#cb27-407" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-408"><a href="#cb27-408" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = P8MEA_NFSM6CLA1A, x = PTFSM6CLA1A)) +</span></span>
<span id="cb27-409"><a href="#cb27-409" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-410"><a href="#cb27-410" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = P8MEA_NFSM6CLA1A, x = PTFSM6CLA1A, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-411"><a href="#cb27-411" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-412"><a href="#cb27-412" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-413"><a href="#cb27-413" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-414"><a href="#cb27-414" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Progress 8 Non-Disadvantaged vs % School Percentage of \nDisadvantaged Students, 2022-23",</span></span>
<span id="cb27-415"><a href="#cb27-415" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Disadvantaged Students",</span></span>
<span id="cb27-416"><a href="#cb27-416" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Progress 8 measure",</span></span>
<span id="cb27-417"><a href="#cb27-417" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-418"><a href="#cb27-418" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-419"><a href="#cb27-419" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-420"><a href="#cb27-420" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(england_school_2022_23_not_special$P8MEA_NFSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-421"><a href="#cb27-421" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-422"><a href="#cb27-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-423"><a href="#cb27-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-424"><a href="#cb27-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-425"><a href="#cb27-425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-426"><a href="#cb27-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-427"><a href="#cb27-427" aria-hidden="true" tabindex="-1"></a><span class="fu">### Progress Non-Disadvantaged B&amp;H Range</span></span>
<span id="cb27-428"><a href="#cb27-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-429"><a href="#cb27-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-430"><a href="#cb27-430" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-431"><a href="#cb27-431" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-432"><a href="#cb27-432" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-433"><a href="#cb27-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-434"><a href="#cb27-434" aria-hidden="true" tabindex="-1"></a><span class="in"># Create the subset</span></span>
<span id="cb27-435"><a href="#cb27-435" aria-hidden="true" tabindex="-1"></a><span class="in">subset_data &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-436"><a href="#cb27-436" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &gt;= min_value &amp; PTFSM6CLA1A &lt;= max_value)</span></span>
<span id="cb27-437"><a href="#cb27-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-438"><a href="#cb27-438" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model</span></span>
<span id="cb27-439"><a href="#cb27-439" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(P8MEA_NFSM6CLA1A ~ PTFSM6CLA1A, data = subset_data)</span></span>
<span id="cb27-440"><a href="#cb27-440" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-441"><a href="#cb27-441" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-442"><a href="#cb27-442" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-443"><a href="#cb27-443" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-444"><a href="#cb27-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-445"><a href="#cb27-445" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-446"><a href="#cb27-446" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-447"><a href="#cb27-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-448"><a href="#cb27-448" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-449"><a href="#cb27-449" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(subset_data, aes(y = P8MEA_NFSM6CLA1A, x = PTFSM6CLA1A)) +</span></span>
<span id="cb27-450"><a href="#cb27-450" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-451"><a href="#cb27-451" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = P8MEA_NFSM6CLA1A, x = PTFSM6CLA1A, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-452"><a href="#cb27-452" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-453"><a href="#cb27-453" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-454"><a href="#cb27-454" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-455"><a href="#cb27-455" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Progress 8 Non-Disadvantaged vs % Percentage of \nDisadvantaged Students, 2022-23",</span></span>
<span id="cb27-456"><a href="#cb27-456" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Disadvantaged Students",</span></span>
<span id="cb27-457"><a href="#cb27-457" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Progress 8 measure",</span></span>
<span id="cb27-458"><a href="#cb27-458" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-459"><a href="#cb27-459" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-460"><a href="#cb27-460" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-461"><a href="#cb27-461" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(subset_data$P8MEA_NFSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-462"><a href="#cb27-462" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-463"><a href="#cb27-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-464"><a href="#cb27-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-465"><a href="#cb27-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-466"><a href="#cb27-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-467"><a href="#cb27-467" aria-hidden="true" tabindex="-1"></a><span class="fu">### Progress Non-Disadvantaged Mixed Ranges</span></span>
<span id="cb27-468"><a href="#cb27-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-469"><a href="#cb27-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-470"><a href="#cb27-470" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-471"><a href="#cb27-471" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-472"><a href="#cb27-472" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-473"><a href="#cb27-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-474"><a href="#cb27-474" aria-hidden="true" tabindex="-1"></a><span class="in"># Create subsets</span></span>
<span id="cb27-475"><a href="#cb27-475" aria-hidden="true" tabindex="-1"></a><span class="in">subset_before &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-476"><a href="#cb27-476" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &lt; min_value)</span></span>
<span id="cb27-477"><a href="#cb27-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-478"><a href="#cb27-478" aria-hidden="true" tabindex="-1"></a><span class="in">subset_after &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-479"><a href="#cb27-479" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &gt; max_value)</span></span>
<span id="cb27-480"><a href="#cb27-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-481"><a href="#cb27-481" aria-hidden="true" tabindex="-1"></a><span class="in">subset_within &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-482"><a href="#cb27-482" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &gt;= min_value &amp; PTFSM6CLA1A &lt;= max_value)</span></span>
<span id="cb27-483"><a href="#cb27-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-484"><a href="#cb27-484" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit linear models</span></span>
<span id="cb27-485"><a href="#cb27-485" aria-hidden="true" tabindex="-1"></a><span class="in">lm_before &lt;- lm(P8MEA_NFSM6CLA1A ~ PTFSM6CLA1A, data = subset_before)</span></span>
<span id="cb27-486"><a href="#cb27-486" aria-hidden="true" tabindex="-1"></a><span class="in">lm_within &lt;- lm(P8MEA_NFSM6CLA1A ~ PTFSM6CLA1A, data = subset_within)</span></span>
<span id="cb27-487"><a href="#cb27-487" aria-hidden="true" tabindex="-1"></a><span class="in">lm_after &lt;- lm(P8MEA_NFSM6CLA1A ~ PTFSM6CLA1A, data = subset_after)</span></span>
<span id="cb27-488"><a href="#cb27-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-489"><a href="#cb27-489" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate middle x positions for annotations</span></span>
<span id="cb27-490"><a href="#cb27-490" aria-hidden="true" tabindex="-1"></a><span class="in">middle_before &lt;- mean(c(0, min_value))</span></span>
<span id="cb27-491"><a href="#cb27-491" aria-hidden="true" tabindex="-1"></a><span class="in">middle_within &lt;- mean(c(min_value, max_value))</span></span>
<span id="cb27-492"><a href="#cb27-492" aria-hidden="true" tabindex="-1"></a><span class="in">middle_after &lt;- mean(c(max_value, 100))</span></span>
<span id="cb27-493"><a href="#cb27-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-494"><a href="#cb27-494" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with annotations</span></span>
<span id="cb27-495"><a href="#cb27-495" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = P8MEA_NFSM6CLA1A, x = PTFSM6CLA1A)) +</span></span>
<span id="cb27-496"><a href="#cb27-496" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-497"><a href="#cb27-497" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = P8MEA_NFSM6CLA1A, x = PTFSM6CLA1A, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-498"><a href="#cb27-498" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-499"><a href="#cb27-499" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-500"><a href="#cb27-500" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_before, method = "lm", se = TRUE, color = "red", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-501"><a href="#cb27-501" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_within, method = "lm", se = TRUE, color = "green", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-502"><a href="#cb27-502" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_after, method = "lm", se = TRUE, color = "purple", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-503"><a href="#cb27-503" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Progress 8 Non-Disadvantaged vs % Percentage of \nDisadvantaged Students, 2022-23",</span></span>
<span id="cb27-504"><a href="#cb27-504" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "School % Percentage of Disadvantaged Students",</span></span>
<span id="cb27-505"><a href="#cb27-505" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Progress 8 measure",</span></span>
<span id="cb27-506"><a href="#cb27-506" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-507"><a href="#cb27-507" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-508"><a href="#cb27-508" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-509"><a href="#cb27-509" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_before, y = min(subset_before$P8MEA_NFSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-510"><a href="#cb27-510" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Lower B&amp;H\nSlope:", round(coef(lm_before)[2], 2),</span></span>
<span id="cb27-511"><a href="#cb27-511" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_before)[1], 2),</span></span>
<span id="cb27-512"><a href="#cb27-512" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_before)$r.squared, 2)), </span></span>
<span id="cb27-513"><a href="#cb27-513" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 0, size = 3) +</span></span>
<span id="cb27-514"><a href="#cb27-514" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_within, y = min(subset_within$P8MEA_NFSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-515"><a href="#cb27-515" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("B&amp;H FSM Range\nSlope:", round(coef(lm_within)[2], 2),</span></span>
<span id="cb27-516"><a href="#cb27-516" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_within)[1], 2),</span></span>
<span id="cb27-517"><a href="#cb27-517" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_within)$r.squared, 2)), </span></span>
<span id="cb27-518"><a href="#cb27-518" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3) +</span></span>
<span id="cb27-519"><a href="#cb27-519" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_after, y = min(subset_after$P8MEA_NFSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-520"><a href="#cb27-520" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Higher B&amp;H\nSlope:", round(coef(lm_after)[2], 2),</span></span>
<span id="cb27-521"><a href="#cb27-521" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_after)[1], 2),</span></span>
<span id="cb27-522"><a href="#cb27-522" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_after)$r.squared, 2)), </span></span>
<span id="cb27-523"><a href="#cb27-523" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3)</span></span>
<span id="cb27-524"><a href="#cb27-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-525"><a href="#cb27-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-526"><a href="#cb27-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-527"><a href="#cb27-527" aria-hidden="true" tabindex="-1"></a><span class="fu">### Progress Disadvantaged All</span></span>
<span id="cb27-528"><a href="#cb27-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-529"><a href="#cb27-529" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-530"><a href="#cb27-530" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-531"><a href="#cb27-531" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-532"><a href="#cb27-532" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-533"><a href="#cb27-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-534"><a href="#cb27-534" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model for the entire data</span></span>
<span id="cb27-535"><a href="#cb27-535" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(P8MEA_FSM6CLA1A ~ PTFSM6CLA1A, data = england_school_2022_23_not_special)</span></span>
<span id="cb27-536"><a href="#cb27-536" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-537"><a href="#cb27-537" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-538"><a href="#cb27-538" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-539"><a href="#cb27-539" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-540"><a href="#cb27-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-541"><a href="#cb27-541" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-542"><a href="#cb27-542" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-543"><a href="#cb27-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-544"><a href="#cb27-544" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-545"><a href="#cb27-545" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = P8MEA_FSM6CLA1A, x = PTFSM6CLA1A)) +</span></span>
<span id="cb27-546"><a href="#cb27-546" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-547"><a href="#cb27-547" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = P8MEA_FSM6CLA1A, x = PTFSM6CLA1A, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-548"><a href="#cb27-548" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-549"><a href="#cb27-549" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-550"><a href="#cb27-550" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-551"><a href="#cb27-551" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Progress 8 Disadvantaged vs % School Percentage of \nDisadvantaged Students, 2022-23",</span></span>
<span id="cb27-552"><a href="#cb27-552" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Disadvantaged Students",</span></span>
<span id="cb27-553"><a href="#cb27-553" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Progress 8 measure",</span></span>
<span id="cb27-554"><a href="#cb27-554" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-555"><a href="#cb27-555" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-556"><a href="#cb27-556" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-557"><a href="#cb27-557" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(england_school_2022_23_not_special$P8MEA_FSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-558"><a href="#cb27-558" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-559"><a href="#cb27-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-560"><a href="#cb27-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-561"><a href="#cb27-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-562"><a href="#cb27-562" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-563"><a href="#cb27-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-564"><a href="#cb27-564" aria-hidden="true" tabindex="-1"></a><span class="fu">### Progress Disadvantaged B&amp;H Range</span></span>
<span id="cb27-565"><a href="#cb27-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-566"><a href="#cb27-566" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-567"><a href="#cb27-567" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-568"><a href="#cb27-568" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-569"><a href="#cb27-569" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-570"><a href="#cb27-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-571"><a href="#cb27-571" aria-hidden="true" tabindex="-1"></a><span class="in"># Create the subset</span></span>
<span id="cb27-572"><a href="#cb27-572" aria-hidden="true" tabindex="-1"></a><span class="in">subset_data &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-573"><a href="#cb27-573" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &gt;= min_value &amp; PTFSM6CLA1A &lt;= max_value)</span></span>
<span id="cb27-574"><a href="#cb27-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-575"><a href="#cb27-575" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model</span></span>
<span id="cb27-576"><a href="#cb27-576" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(P8MEA_FSM6CLA1A ~ PTFSM6CLA1A, data = subset_data)</span></span>
<span id="cb27-577"><a href="#cb27-577" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-578"><a href="#cb27-578" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-579"><a href="#cb27-579" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-580"><a href="#cb27-580" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-581"><a href="#cb27-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-582"><a href="#cb27-582" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-583"><a href="#cb27-583" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-584"><a href="#cb27-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-585"><a href="#cb27-585" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-586"><a href="#cb27-586" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(subset_data, aes(y = P8MEA_FSM6CLA1A, x = PTFSM6CLA1A)) +</span></span>
<span id="cb27-587"><a href="#cb27-587" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-588"><a href="#cb27-588" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = P8MEA_FSM6CLA1A, x = PTFSM6CLA1A, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-589"><a href="#cb27-589" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-590"><a href="#cb27-590" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-591"><a href="#cb27-591" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-592"><a href="#cb27-592" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Progress 8 Disadvantaged vs % Percentage of \nDisadvantaged Students, 2022-23",</span></span>
<span id="cb27-593"><a href="#cb27-593" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Disadvantaged Students",</span></span>
<span id="cb27-594"><a href="#cb27-594" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Progress 8 measure",</span></span>
<span id="cb27-595"><a href="#cb27-595" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-596"><a href="#cb27-596" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-597"><a href="#cb27-597" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-598"><a href="#cb27-598" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(subset_data$P8MEA_FSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-599"><a href="#cb27-599" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 0.5, vjust = -1, size = 3)</span></span>
<span id="cb27-600"><a href="#cb27-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-601"><a href="#cb27-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-602"><a href="#cb27-602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-603"><a href="#cb27-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-604"><a href="#cb27-604" aria-hidden="true" tabindex="-1"></a><span class="fu">### Progress Disadvantaged Mixed Ranges</span></span>
<span id="cb27-605"><a href="#cb27-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-606"><a href="#cb27-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-607"><a href="#cb27-607" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-608"><a href="#cb27-608" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-609"><a href="#cb27-609" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PTFSM6CLA1A, na.rm = TRUE)</span></span>
<span id="cb27-610"><a href="#cb27-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-611"><a href="#cb27-611" aria-hidden="true" tabindex="-1"></a><span class="in"># Create subsets</span></span>
<span id="cb27-612"><a href="#cb27-612" aria-hidden="true" tabindex="-1"></a><span class="in">subset_before &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-613"><a href="#cb27-613" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &lt; min_value)</span></span>
<span id="cb27-614"><a href="#cb27-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-615"><a href="#cb27-615" aria-hidden="true" tabindex="-1"></a><span class="in">subset_after &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-616"><a href="#cb27-616" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &gt; max_value)</span></span>
<span id="cb27-617"><a href="#cb27-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-618"><a href="#cb27-618" aria-hidden="true" tabindex="-1"></a><span class="in">subset_within &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-619"><a href="#cb27-619" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PTFSM6CLA1A &gt;= min_value &amp; PTFSM6CLA1A &lt;= max_value)</span></span>
<span id="cb27-620"><a href="#cb27-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-621"><a href="#cb27-621" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit linear models</span></span>
<span id="cb27-622"><a href="#cb27-622" aria-hidden="true" tabindex="-1"></a><span class="in">lm_before &lt;- lm(P8MEA_FSM6CLA1A ~ PTFSM6CLA1A, data = subset_before)</span></span>
<span id="cb27-623"><a href="#cb27-623" aria-hidden="true" tabindex="-1"></a><span class="in">lm_within &lt;- lm(P8MEA_FSM6CLA1A ~ PTFSM6CLA1A, data = subset_within)</span></span>
<span id="cb27-624"><a href="#cb27-624" aria-hidden="true" tabindex="-1"></a><span class="in">lm_after &lt;- lm(P8MEA_FSM6CLA1A ~ PTFSM6CLA1A, data = subset_after)</span></span>
<span id="cb27-625"><a href="#cb27-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-626"><a href="#cb27-626" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate middle x positions for annotations</span></span>
<span id="cb27-627"><a href="#cb27-627" aria-hidden="true" tabindex="-1"></a><span class="in">middle_before &lt;- mean(c(0, min_value))</span></span>
<span id="cb27-628"><a href="#cb27-628" aria-hidden="true" tabindex="-1"></a><span class="in">middle_within &lt;- mean(c(min_value, max_value))</span></span>
<span id="cb27-629"><a href="#cb27-629" aria-hidden="true" tabindex="-1"></a><span class="in">middle_after &lt;- mean(c(max_value, 100))</span></span>
<span id="cb27-630"><a href="#cb27-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-631"><a href="#cb27-631" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with annotations</span></span>
<span id="cb27-632"><a href="#cb27-632" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = P8MEA_FSM6CLA1A, x = PTFSM6CLA1A)) +</span></span>
<span id="cb27-633"><a href="#cb27-633" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-634"><a href="#cb27-634" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = P8MEA_FSM6CLA1A, x = PTFSM6CLA1A, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-635"><a href="#cb27-635" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-636"><a href="#cb27-636" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-637"><a href="#cb27-637" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_before, method = "lm", se = TRUE, color = "red", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-638"><a href="#cb27-638" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_within, method = "lm", se = TRUE, color = "green", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-639"><a href="#cb27-639" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_after, method = "lm", se = TRUE, color = "purple", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-640"><a href="#cb27-640" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Progress 8 Disadvantaged vs % Percentage of \nDisadvantaged Students, 2022-23",</span></span>
<span id="cb27-641"><a href="#cb27-641" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "School % Percentage of Disadvantaged Students",</span></span>
<span id="cb27-642"><a href="#cb27-642" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Progress 8 measure",</span></span>
<span id="cb27-643"><a href="#cb27-643" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-644"><a href="#cb27-644" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-645"><a href="#cb27-645" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-646"><a href="#cb27-646" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_before, y = min(subset_before$P8MEA_FSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-647"><a href="#cb27-647" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Lower B&amp;H\nSlope:", round(coef(lm_before)[2], 2),</span></span>
<span id="cb27-648"><a href="#cb27-648" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_before)[1], 2),</span></span>
<span id="cb27-649"><a href="#cb27-649" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_before)$r.squared, 2)), </span></span>
<span id="cb27-650"><a href="#cb27-650" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3) +</span></span>
<span id="cb27-651"><a href="#cb27-651" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_within, y = min(subset_within$P8MEA_FSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-652"><a href="#cb27-652" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("B&amp;H FSM Range\nSlope:", round(coef(lm_within)[2], 2),</span></span>
<span id="cb27-653"><a href="#cb27-653" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_within)[1], 2),</span></span>
<span id="cb27-654"><a href="#cb27-654" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_within)$r.squared, 2)), </span></span>
<span id="cb27-655"><a href="#cb27-655" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 0.5, size = 3) +</span></span>
<span id="cb27-656"><a href="#cb27-656" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_after, y = min(subset_after$P8MEA_FSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-657"><a href="#cb27-657" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Higher B&amp;H\nSlope:", round(coef(lm_after)[2], 2),</span></span>
<span id="cb27-658"><a href="#cb27-658" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_after)[1], 2),</span></span>
<span id="cb27-659"><a href="#cb27-659" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_after)$r.squared, 2)), </span></span>
<span id="cb27-660"><a href="#cb27-660" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3)</span></span>
<span id="cb27-661"><a href="#cb27-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-662"><a href="#cb27-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-663"><a href="#cb27-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-664"><a href="#cb27-664" aria-hidden="true" tabindex="-1"></a><span class="fu"># Persistent Absence</span></span>
<span id="cb27-665"><a href="#cb27-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-666"><a href="#cb27-666" aria-hidden="true" tabindex="-1"></a><span class="fu">## Attainment 8</span></span>
<span id="cb27-667"><a href="#cb27-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-668"><a href="#cb27-668" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attainment Non-Disadvantaged All</span></span>
<span id="cb27-669"><a href="#cb27-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-670"><a href="#cb27-670" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-671"><a href="#cb27-671" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-672"><a href="#cb27-672" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-673"><a href="#cb27-673" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-674"><a href="#cb27-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-675"><a href="#cb27-675" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model for the entire data</span></span>
<span id="cb27-676"><a href="#cb27-676" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(ATT8SCR_NFSM6CLA1A ~ PPERSABS10, data = england_school_2022_23_not_special)</span></span>
<span id="cb27-677"><a href="#cb27-677" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-678"><a href="#cb27-678" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-679"><a href="#cb27-679" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-680"><a href="#cb27-680" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-681"><a href="#cb27-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-682"><a href="#cb27-682" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-683"><a href="#cb27-683" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-684"><a href="#cb27-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-685"><a href="#cb27-685" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-686"><a href="#cb27-686" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = ATT8SCR_NFSM6CLA1A, x = PPERSABS10)) +</span></span>
<span id="cb27-687"><a href="#cb27-687" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-688"><a href="#cb27-688" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = ATT8SCR_NFSM6CLA1A, x = PPERSABS10, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-689"><a href="#cb27-689" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-690"><a href="#cb27-690" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-691"><a href="#cb27-691" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-692"><a href="#cb27-692" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Attainment 8 Non-Disadvantaged vs % School Percentage of \nPersistently Absent Students, 2022-23",</span></span>
<span id="cb27-693"><a href="#cb27-693" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Persistently Absent Students",</span></span>
<span id="cb27-694"><a href="#cb27-694" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Attainment 8 measure",</span></span>
<span id="cb27-695"><a href="#cb27-695" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-696"><a href="#cb27-696" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-697"><a href="#cb27-697" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-698"><a href="#cb27-698" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(england_school_2022_23_not_special$ATT8SCR_NFSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-699"><a href="#cb27-699" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-700"><a href="#cb27-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-701"><a href="#cb27-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-702"><a href="#cb27-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-703"><a href="#cb27-703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-704"><a href="#cb27-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-705"><a href="#cb27-705" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attainment Non-Disadvantaged B&amp;H Range</span></span>
<span id="cb27-706"><a href="#cb27-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-707"><a href="#cb27-707" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-708"><a href="#cb27-708" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-709"><a href="#cb27-709" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-710"><a href="#cb27-710" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-711"><a href="#cb27-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-712"><a href="#cb27-712" aria-hidden="true" tabindex="-1"></a><span class="in"># Create the subset</span></span>
<span id="cb27-713"><a href="#cb27-713" aria-hidden="true" tabindex="-1"></a><span class="in">subset_data &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-714"><a href="#cb27-714" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &gt;= min_value &amp; PPERSABS10 &lt;= max_value)</span></span>
<span id="cb27-715"><a href="#cb27-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-716"><a href="#cb27-716" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model</span></span>
<span id="cb27-717"><a href="#cb27-717" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(ATT8SCR_NFSM6CLA1A ~ PPERSABS10, data = subset_data)</span></span>
<span id="cb27-718"><a href="#cb27-718" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-719"><a href="#cb27-719" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-720"><a href="#cb27-720" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-721"><a href="#cb27-721" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-722"><a href="#cb27-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-723"><a href="#cb27-723" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-724"><a href="#cb27-724" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-725"><a href="#cb27-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-726"><a href="#cb27-726" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-727"><a href="#cb27-727" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(subset_data, aes(y = ATT8SCR_NFSM6CLA1A, x = PPERSABS10)) +</span></span>
<span id="cb27-728"><a href="#cb27-728" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-729"><a href="#cb27-729" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = ATT8SCR_NFSM6CLA1A, x = PPERSABS10, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-730"><a href="#cb27-730" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-731"><a href="#cb27-731" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-732"><a href="#cb27-732" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-733"><a href="#cb27-733" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Attainment Non-Disadvantaged 8 vs % Percentage of \nPersistently Absent Students, 2022-23",</span></span>
<span id="cb27-734"><a href="#cb27-734" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Persistently Absent Students",</span></span>
<span id="cb27-735"><a href="#cb27-735" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Attainment 8 measure",</span></span>
<span id="cb27-736"><a href="#cb27-736" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-737"><a href="#cb27-737" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-738"><a href="#cb27-738" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-739"><a href="#cb27-739" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(subset_data$ATT8SCR_NFSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-740"><a href="#cb27-740" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-741"><a href="#cb27-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-742"><a href="#cb27-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-743"><a href="#cb27-743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-744"><a href="#cb27-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-745"><a href="#cb27-745" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attainment Non-Disadvantaged Mixed Ranges</span></span>
<span id="cb27-746"><a href="#cb27-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-747"><a href="#cb27-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-748"><a href="#cb27-748" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-749"><a href="#cb27-749" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-750"><a href="#cb27-750" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-751"><a href="#cb27-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-752"><a href="#cb27-752" aria-hidden="true" tabindex="-1"></a><span class="in"># Create subsets</span></span>
<span id="cb27-753"><a href="#cb27-753" aria-hidden="true" tabindex="-1"></a><span class="in">subset_before &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-754"><a href="#cb27-754" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &lt; min_value)</span></span>
<span id="cb27-755"><a href="#cb27-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-756"><a href="#cb27-756" aria-hidden="true" tabindex="-1"></a><span class="in">subset_after &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-757"><a href="#cb27-757" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &gt; max_value)</span></span>
<span id="cb27-758"><a href="#cb27-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-759"><a href="#cb27-759" aria-hidden="true" tabindex="-1"></a><span class="in">subset_within &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-760"><a href="#cb27-760" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &gt;= min_value &amp; PPERSABS10 &lt;= max_value)</span></span>
<span id="cb27-761"><a href="#cb27-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-762"><a href="#cb27-762" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit linear models</span></span>
<span id="cb27-763"><a href="#cb27-763" aria-hidden="true" tabindex="-1"></a><span class="in">lm_before &lt;- lm(ATT8SCR_NFSM6CLA1A ~ PPERSABS10, data = subset_before)</span></span>
<span id="cb27-764"><a href="#cb27-764" aria-hidden="true" tabindex="-1"></a><span class="in">lm_within &lt;- lm(ATT8SCR_NFSM6CLA1A ~ PPERSABS10, data = subset_within)</span></span>
<span id="cb27-765"><a href="#cb27-765" aria-hidden="true" tabindex="-1"></a><span class="in">lm_after &lt;- lm(ATT8SCR_NFSM6CLA1A ~ PPERSABS10, data = subset_after)</span></span>
<span id="cb27-766"><a href="#cb27-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-767"><a href="#cb27-767" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate middle x positions for annotations</span></span>
<span id="cb27-768"><a href="#cb27-768" aria-hidden="true" tabindex="-1"></a><span class="in">middle_before &lt;- mean(c(0, min_value))</span></span>
<span id="cb27-769"><a href="#cb27-769" aria-hidden="true" tabindex="-1"></a><span class="in">middle_within &lt;- mean(c(min_value, max_value))</span></span>
<span id="cb27-770"><a href="#cb27-770" aria-hidden="true" tabindex="-1"></a><span class="in">middle_after &lt;- mean(c(max_value, 100))</span></span>
<span id="cb27-771"><a href="#cb27-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-772"><a href="#cb27-772" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with annotations</span></span>
<span id="cb27-773"><a href="#cb27-773" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = ATT8SCR_NFSM6CLA1A, x = PPERSABS10)) +</span></span>
<span id="cb27-774"><a href="#cb27-774" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-775"><a href="#cb27-775" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = ATT8SCR_NFSM6CLA1A, x = PPERSABS10, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-776"><a href="#cb27-776" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-777"><a href="#cb27-777" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-778"><a href="#cb27-778" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_before, method = "lm", se = TRUE, color = "red", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-779"><a href="#cb27-779" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_within, method = "lm", se = TRUE, color = "green", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-780"><a href="#cb27-780" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_after, method = "lm", se = TRUE, color = "purple", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-781"><a href="#cb27-781" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Attainment 8 Non-Disadvantaged vs % Percentage of \nPersistently Absent Students, 2022-23",</span></span>
<span id="cb27-782"><a href="#cb27-782" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "School % Percentage of Persistently Absent Students",</span></span>
<span id="cb27-783"><a href="#cb27-783" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Attainment 8 measure",</span></span>
<span id="cb27-784"><a href="#cb27-784" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-785"><a href="#cb27-785" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-786"><a href="#cb27-786" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-787"><a href="#cb27-787" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_before, y = min(subset_before$ATT8SCR_NFSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-788"><a href="#cb27-788" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Lower B&amp;H\nSlope:", round(coef(lm_before)[2], 2),</span></span>
<span id="cb27-789"><a href="#cb27-789" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_before)[1], 2),</span></span>
<span id="cb27-790"><a href="#cb27-790" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_before)$r.squared, 2)), </span></span>
<span id="cb27-791"><a href="#cb27-791" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 0, size = 3) +</span></span>
<span id="cb27-792"><a href="#cb27-792" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_within, y = min(subset_within$ATT8SCR_NFSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-793"><a href="#cb27-793" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("B&amp;H P-Abs Range\nSlope:", round(coef(lm_within)[2], 2),</span></span>
<span id="cb27-794"><a href="#cb27-794" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_within)[1], 2),</span></span>
<span id="cb27-795"><a href="#cb27-795" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_within)$r.squared, 2)), </span></span>
<span id="cb27-796"><a href="#cb27-796" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3) +</span></span>
<span id="cb27-797"><a href="#cb27-797" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_after, y = min(subset_after$ATT8SCR_NFSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-798"><a href="#cb27-798" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Higher B&amp;H\nSlope:", round(coef(lm_after)[2], 2),</span></span>
<span id="cb27-799"><a href="#cb27-799" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_after)[1], 2),</span></span>
<span id="cb27-800"><a href="#cb27-800" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_after)$r.squared, 2)), </span></span>
<span id="cb27-801"><a href="#cb27-801" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3)</span></span>
<span id="cb27-802"><a href="#cb27-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-803"><a href="#cb27-803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-804"><a href="#cb27-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-805"><a href="#cb27-805" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attainment Disadvantaged All</span></span>
<span id="cb27-806"><a href="#cb27-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-807"><a href="#cb27-807" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-808"><a href="#cb27-808" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-809"><a href="#cb27-809" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-810"><a href="#cb27-810" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-811"><a href="#cb27-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-812"><a href="#cb27-812" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model for the entire data</span></span>
<span id="cb27-813"><a href="#cb27-813" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(ATT8SCR_FSM6CLA1A ~ PPERSABS10, data = england_school_2022_23_not_special)</span></span>
<span id="cb27-814"><a href="#cb27-814" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-815"><a href="#cb27-815" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-816"><a href="#cb27-816" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-817"><a href="#cb27-817" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-818"><a href="#cb27-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-819"><a href="#cb27-819" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-820"><a href="#cb27-820" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-821"><a href="#cb27-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-822"><a href="#cb27-822" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-823"><a href="#cb27-823" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = ATT8SCR_FSM6CLA1A, x = PPERSABS10)) +</span></span>
<span id="cb27-824"><a href="#cb27-824" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-825"><a href="#cb27-825" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = ATT8SCR_FSM6CLA1A, x = PPERSABS10, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-826"><a href="#cb27-826" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-827"><a href="#cb27-827" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-828"><a href="#cb27-828" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-829"><a href="#cb27-829" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Attainment 8 Disadvantaged vs % School Percentage of \nPersistently Absent Students, 2022-23",</span></span>
<span id="cb27-830"><a href="#cb27-830" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Persistently Absent Students",</span></span>
<span id="cb27-831"><a href="#cb27-831" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Attainment 8 measure",</span></span>
<span id="cb27-832"><a href="#cb27-832" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-833"><a href="#cb27-833" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-834"><a href="#cb27-834" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-835"><a href="#cb27-835" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(england_school_2022_23_not_special$ATT8SCR_FSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-836"><a href="#cb27-836" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-837"><a href="#cb27-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-838"><a href="#cb27-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-839"><a href="#cb27-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-840"><a href="#cb27-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-841"><a href="#cb27-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-842"><a href="#cb27-842" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attainment Disadvantaged B&amp;H Range</span></span>
<span id="cb27-843"><a href="#cb27-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-844"><a href="#cb27-844" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-845"><a href="#cb27-845" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-846"><a href="#cb27-846" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-847"><a href="#cb27-847" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-848"><a href="#cb27-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-849"><a href="#cb27-849" aria-hidden="true" tabindex="-1"></a><span class="in"># Create the subset</span></span>
<span id="cb27-850"><a href="#cb27-850" aria-hidden="true" tabindex="-1"></a><span class="in">subset_data &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-851"><a href="#cb27-851" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &gt;= min_value &amp; PPERSABS10 &lt;= max_value)</span></span>
<span id="cb27-852"><a href="#cb27-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-853"><a href="#cb27-853" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model</span></span>
<span id="cb27-854"><a href="#cb27-854" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(ATT8SCR_FSM6CLA1A ~ PPERSABS10, data = subset_data)</span></span>
<span id="cb27-855"><a href="#cb27-855" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-856"><a href="#cb27-856" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-857"><a href="#cb27-857" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-858"><a href="#cb27-858" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-859"><a href="#cb27-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-860"><a href="#cb27-860" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-861"><a href="#cb27-861" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-862"><a href="#cb27-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-863"><a href="#cb27-863" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-864"><a href="#cb27-864" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(subset_data, aes(y = ATT8SCR_FSM6CLA1A, x = PPERSABS10)) +</span></span>
<span id="cb27-865"><a href="#cb27-865" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-866"><a href="#cb27-866" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = ATT8SCR_FSM6CLA1A, x = PPERSABS10, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-867"><a href="#cb27-867" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-868"><a href="#cb27-868" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-869"><a href="#cb27-869" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-870"><a href="#cb27-870" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Attainment Disadvantaged 8 vs % Percentage of \nPersistently Absent Students, 2022-23",</span></span>
<span id="cb27-871"><a href="#cb27-871" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Persistently Absent Students",</span></span>
<span id="cb27-872"><a href="#cb27-872" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Attainment 8 measure",</span></span>
<span id="cb27-873"><a href="#cb27-873" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-874"><a href="#cb27-874" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-875"><a href="#cb27-875" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-876"><a href="#cb27-876" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(subset_data$ATT8SCR_FSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-877"><a href="#cb27-877" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-878"><a href="#cb27-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-879"><a href="#cb27-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-880"><a href="#cb27-880" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-881"><a href="#cb27-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-882"><a href="#cb27-882" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attainment Disadvantaged Mixed Ranges</span></span>
<span id="cb27-883"><a href="#cb27-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-884"><a href="#cb27-884" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-885"><a href="#cb27-885" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-886"><a href="#cb27-886" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-887"><a href="#cb27-887" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-888"><a href="#cb27-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-889"><a href="#cb27-889" aria-hidden="true" tabindex="-1"></a><span class="in"># Create subsets</span></span>
<span id="cb27-890"><a href="#cb27-890" aria-hidden="true" tabindex="-1"></a><span class="in">subset_before &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-891"><a href="#cb27-891" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &lt; min_value)</span></span>
<span id="cb27-892"><a href="#cb27-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-893"><a href="#cb27-893" aria-hidden="true" tabindex="-1"></a><span class="in">subset_after &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-894"><a href="#cb27-894" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &gt; max_value)</span></span>
<span id="cb27-895"><a href="#cb27-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-896"><a href="#cb27-896" aria-hidden="true" tabindex="-1"></a><span class="in">subset_within &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-897"><a href="#cb27-897" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &gt;= min_value &amp; PPERSABS10 &lt;= max_value)</span></span>
<span id="cb27-898"><a href="#cb27-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-899"><a href="#cb27-899" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit linear models</span></span>
<span id="cb27-900"><a href="#cb27-900" aria-hidden="true" tabindex="-1"></a><span class="in">lm_before &lt;- lm(ATT8SCR_FSM6CLA1A ~ PPERSABS10, data = subset_before)</span></span>
<span id="cb27-901"><a href="#cb27-901" aria-hidden="true" tabindex="-1"></a><span class="in">lm_within &lt;- lm(ATT8SCR_FSM6CLA1A ~ PPERSABS10, data = subset_within)</span></span>
<span id="cb27-902"><a href="#cb27-902" aria-hidden="true" tabindex="-1"></a><span class="in">lm_after &lt;- lm(ATT8SCR_FSM6CLA1A ~ PPERSABS10, data = subset_after)</span></span>
<span id="cb27-903"><a href="#cb27-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-904"><a href="#cb27-904" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate middle x positions for annotations</span></span>
<span id="cb27-905"><a href="#cb27-905" aria-hidden="true" tabindex="-1"></a><span class="in">middle_before &lt;- mean(c(0, min_value))</span></span>
<span id="cb27-906"><a href="#cb27-906" aria-hidden="true" tabindex="-1"></a><span class="in">middle_within &lt;- mean(c(min_value, max_value))</span></span>
<span id="cb27-907"><a href="#cb27-907" aria-hidden="true" tabindex="-1"></a><span class="in">middle_after &lt;- mean(c(max_value, 100))</span></span>
<span id="cb27-908"><a href="#cb27-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-909"><a href="#cb27-909" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with annotations</span></span>
<span id="cb27-910"><a href="#cb27-910" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = ATT8SCR_FSM6CLA1A, x = PPERSABS10)) +</span></span>
<span id="cb27-911"><a href="#cb27-911" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-912"><a href="#cb27-912" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = ATT8SCR_FSM6CLA1A, x = PPERSABS10, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-913"><a href="#cb27-913" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-914"><a href="#cb27-914" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-915"><a href="#cb27-915" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_before, method = "lm", se = TRUE, color = "red", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-916"><a href="#cb27-916" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_within, method = "lm", se = TRUE, color = "green", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-917"><a href="#cb27-917" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_after, method = "lm", se = TRUE, color = "purple", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-918"><a href="#cb27-918" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Attainment 8 Disadvantaged vs % Percentage of \nPersistently Absent Students, 2022-23",</span></span>
<span id="cb27-919"><a href="#cb27-919" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "School % Percentage of Persistently Absent Students",</span></span>
<span id="cb27-920"><a href="#cb27-920" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Attainment 8 measure",</span></span>
<span id="cb27-921"><a href="#cb27-921" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-922"><a href="#cb27-922" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-923"><a href="#cb27-923" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-924"><a href="#cb27-924" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_before, y = min(subset_before$ATT8SCR_FSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-925"><a href="#cb27-925" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Lower B&amp;H\nSlope:", round(coef(lm_before)[2], 2),</span></span>
<span id="cb27-926"><a href="#cb27-926" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_before)[1], 2),</span></span>
<span id="cb27-927"><a href="#cb27-927" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_before)$r.squared, 2)), </span></span>
<span id="cb27-928"><a href="#cb27-928" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3) +</span></span>
<span id="cb27-929"><a href="#cb27-929" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_within, y = min(subset_within$ATT8SCR_FSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-930"><a href="#cb27-930" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("B&amp;H P-Abs Range\nSlope:", round(coef(lm_within)[2], 2),</span></span>
<span id="cb27-931"><a href="#cb27-931" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_within)[1], 2),</span></span>
<span id="cb27-932"><a href="#cb27-932" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_within)$r.squared, 2)), </span></span>
<span id="cb27-933"><a href="#cb27-933" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = -3, size = 3) +</span></span>
<span id="cb27-934"><a href="#cb27-934" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_after, y = min(subset_after$ATT8SCR_FSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-935"><a href="#cb27-935" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Higher B&amp;H\nSlope:", round(coef(lm_after)[2], 2),</span></span>
<span id="cb27-936"><a href="#cb27-936" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_after)[1], 2),</span></span>
<span id="cb27-937"><a href="#cb27-937" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_after)$r.squared, 2)), </span></span>
<span id="cb27-938"><a href="#cb27-938" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = -2.5, size = 3)</span></span>
<span id="cb27-939"><a href="#cb27-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-940"><a href="#cb27-940" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-941"><a href="#cb27-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-942"><a href="#cb27-942" aria-hidden="true" tabindex="-1"></a><span class="fu">## Progress 8</span></span>
<span id="cb27-943"><a href="#cb27-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-944"><a href="#cb27-944" aria-hidden="true" tabindex="-1"></a><span class="fu">### Progress Non-Disadvantaged All</span></span>
<span id="cb27-945"><a href="#cb27-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-946"><a href="#cb27-946" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-947"><a href="#cb27-947" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-948"><a href="#cb27-948" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-949"><a href="#cb27-949" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-950"><a href="#cb27-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-951"><a href="#cb27-951" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model for the entire data</span></span>
<span id="cb27-952"><a href="#cb27-952" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(P8MEA_NFSM6CLA1A ~ PPERSABS10, data = england_school_2022_23_not_special)</span></span>
<span id="cb27-953"><a href="#cb27-953" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-954"><a href="#cb27-954" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-955"><a href="#cb27-955" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-956"><a href="#cb27-956" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-957"><a href="#cb27-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-958"><a href="#cb27-958" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-959"><a href="#cb27-959" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-960"><a href="#cb27-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-961"><a href="#cb27-961" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-962"><a href="#cb27-962" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = P8MEA_NFSM6CLA1A, x = PPERSABS10)) +</span></span>
<span id="cb27-963"><a href="#cb27-963" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-964"><a href="#cb27-964" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = P8MEA_NFSM6CLA1A, x = PPERSABS10, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-965"><a href="#cb27-965" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-966"><a href="#cb27-966" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-967"><a href="#cb27-967" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-968"><a href="#cb27-968" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Progress 8 Non-Disadvantaged vs % School Percentage of \nPersistently Absent Students, 2022-23",</span></span>
<span id="cb27-969"><a href="#cb27-969" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Persistently Absent Students",</span></span>
<span id="cb27-970"><a href="#cb27-970" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Progress 8 measure",</span></span>
<span id="cb27-971"><a href="#cb27-971" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-972"><a href="#cb27-972" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-973"><a href="#cb27-973" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-974"><a href="#cb27-974" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(england_school_2022_23_not_special$P8MEA_NFSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-975"><a href="#cb27-975" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-976"><a href="#cb27-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-977"><a href="#cb27-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-978"><a href="#cb27-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-979"><a href="#cb27-979" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-980"><a href="#cb27-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-981"><a href="#cb27-981" aria-hidden="true" tabindex="-1"></a><span class="fu">### Progress Non-Disadvantaged B&amp;H Range</span></span>
<span id="cb27-982"><a href="#cb27-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-983"><a href="#cb27-983" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-984"><a href="#cb27-984" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-985"><a href="#cb27-985" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-986"><a href="#cb27-986" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-987"><a href="#cb27-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-988"><a href="#cb27-988" aria-hidden="true" tabindex="-1"></a><span class="in"># Create the subset</span></span>
<span id="cb27-989"><a href="#cb27-989" aria-hidden="true" tabindex="-1"></a><span class="in">subset_data &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-990"><a href="#cb27-990" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &gt;= min_value &amp; PPERSABS10 &lt;= max_value)</span></span>
<span id="cb27-991"><a href="#cb27-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-992"><a href="#cb27-992" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model</span></span>
<span id="cb27-993"><a href="#cb27-993" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(P8MEA_NFSM6CLA1A ~ PPERSABS10, data = subset_data)</span></span>
<span id="cb27-994"><a href="#cb27-994" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-995"><a href="#cb27-995" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-996"><a href="#cb27-996" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-997"><a href="#cb27-997" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-998"><a href="#cb27-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-999"><a href="#cb27-999" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-1000"><a href="#cb27-1000" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-1001"><a href="#cb27-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1002"><a href="#cb27-1002" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-1003"><a href="#cb27-1003" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(subset_data, aes(y = P8MEA_NFSM6CLA1A, x = PPERSABS10)) +</span></span>
<span id="cb27-1004"><a href="#cb27-1004" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-1005"><a href="#cb27-1005" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = P8MEA_NFSM6CLA1A, x = PPERSABS10, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-1006"><a href="#cb27-1006" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-1007"><a href="#cb27-1007" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-1008"><a href="#cb27-1008" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-1009"><a href="#cb27-1009" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Progress 8 Non-Disadvantaged vs % Percentage of \nPersistently Absent Students, 2022-23",</span></span>
<span id="cb27-1010"><a href="#cb27-1010" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Persistently Absent Students",</span></span>
<span id="cb27-1011"><a href="#cb27-1011" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Progress 8 measure",</span></span>
<span id="cb27-1012"><a href="#cb27-1012" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-1013"><a href="#cb27-1013" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-1014"><a href="#cb27-1014" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-1015"><a href="#cb27-1015" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(subset_data$P8MEA_NFSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-1016"><a href="#cb27-1016" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-1017"><a href="#cb27-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1018"><a href="#cb27-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1019"><a href="#cb27-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1020"><a href="#cb27-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1021"><a href="#cb27-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">### Progress Non-Disadvantaged Mixed Ranges</span></span>
<span id="cb27-1022"><a href="#cb27-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1023"><a href="#cb27-1023" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-1024"><a href="#cb27-1024" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-1025"><a href="#cb27-1025" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-1026"><a href="#cb27-1026" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-1027"><a href="#cb27-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1028"><a href="#cb27-1028" aria-hidden="true" tabindex="-1"></a><span class="in"># Create subsets</span></span>
<span id="cb27-1029"><a href="#cb27-1029" aria-hidden="true" tabindex="-1"></a><span class="in">subset_before &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-1030"><a href="#cb27-1030" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &lt; min_value)</span></span>
<span id="cb27-1031"><a href="#cb27-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1032"><a href="#cb27-1032" aria-hidden="true" tabindex="-1"></a><span class="in">subset_after &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-1033"><a href="#cb27-1033" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &gt; max_value)</span></span>
<span id="cb27-1034"><a href="#cb27-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1035"><a href="#cb27-1035" aria-hidden="true" tabindex="-1"></a><span class="in">subset_within &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-1036"><a href="#cb27-1036" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &gt;= min_value &amp; PPERSABS10 &lt;= max_value)</span></span>
<span id="cb27-1037"><a href="#cb27-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1038"><a href="#cb27-1038" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit linear models</span></span>
<span id="cb27-1039"><a href="#cb27-1039" aria-hidden="true" tabindex="-1"></a><span class="in">lm_before &lt;- lm(P8MEA_NFSM6CLA1A ~ PPERSABS10, data = subset_before)</span></span>
<span id="cb27-1040"><a href="#cb27-1040" aria-hidden="true" tabindex="-1"></a><span class="in">lm_within &lt;- lm(P8MEA_NFSM6CLA1A ~ PPERSABS10, data = subset_within)</span></span>
<span id="cb27-1041"><a href="#cb27-1041" aria-hidden="true" tabindex="-1"></a><span class="in">lm_after &lt;- lm(P8MEA_NFSM6CLA1A ~ PPERSABS10, data = subset_after)</span></span>
<span id="cb27-1042"><a href="#cb27-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1043"><a href="#cb27-1043" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate middle x positions for annotations</span></span>
<span id="cb27-1044"><a href="#cb27-1044" aria-hidden="true" tabindex="-1"></a><span class="in">middle_before &lt;- mean(c(0, min_value))</span></span>
<span id="cb27-1045"><a href="#cb27-1045" aria-hidden="true" tabindex="-1"></a><span class="in">middle_within &lt;- mean(c(min_value, max_value))</span></span>
<span id="cb27-1046"><a href="#cb27-1046" aria-hidden="true" tabindex="-1"></a><span class="in">middle_after &lt;- mean(c(max_value, 100))</span></span>
<span id="cb27-1047"><a href="#cb27-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1048"><a href="#cb27-1048" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with annotations</span></span>
<span id="cb27-1049"><a href="#cb27-1049" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = P8MEA_NFSM6CLA1A, x = PPERSABS10)) +</span></span>
<span id="cb27-1050"><a href="#cb27-1050" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-1051"><a href="#cb27-1051" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = P8MEA_NFSM6CLA1A, x = PPERSABS10, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-1052"><a href="#cb27-1052" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-1053"><a href="#cb27-1053" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-1054"><a href="#cb27-1054" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_before, method = "lm", se = TRUE, color = "red", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-1055"><a href="#cb27-1055" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_within, method = "lm", se = TRUE, color = "green", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-1056"><a href="#cb27-1056" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_after, method = "lm", se = TRUE, color = "purple", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-1057"><a href="#cb27-1057" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Progress 8 Non-Disadvantaged vs % Percentage of \nPersistently Absent Students, 2022-23",</span></span>
<span id="cb27-1058"><a href="#cb27-1058" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "School % Percentage of Persistently Absent Students",</span></span>
<span id="cb27-1059"><a href="#cb27-1059" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Progress 8 measure",</span></span>
<span id="cb27-1060"><a href="#cb27-1060" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-1061"><a href="#cb27-1061" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-1062"><a href="#cb27-1062" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-1063"><a href="#cb27-1063" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_before, y = min(subset_before$P8MEA_NFSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-1064"><a href="#cb27-1064" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Lower B&amp;H\nSlope:", round(coef(lm_before)[2], 2),</span></span>
<span id="cb27-1065"><a href="#cb27-1065" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_before)[1], 2),</span></span>
<span id="cb27-1066"><a href="#cb27-1066" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_before)$r.squared, 2)), </span></span>
<span id="cb27-1067"><a href="#cb27-1067" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3) +</span></span>
<span id="cb27-1068"><a href="#cb27-1068" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_within, y = min(subset_within$P8MEA_NFSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-1069"><a href="#cb27-1069" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("B&amp;H P-Abs Range\nSlope:", round(coef(lm_within)[2], 2),</span></span>
<span id="cb27-1070"><a href="#cb27-1070" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_within)[1], 2),</span></span>
<span id="cb27-1071"><a href="#cb27-1071" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_within)$r.squared, 2)), </span></span>
<span id="cb27-1072"><a href="#cb27-1072" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3) +</span></span>
<span id="cb27-1073"><a href="#cb27-1073" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_after, y = min(subset_after$P8MEA_NFSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-1074"><a href="#cb27-1074" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Higher B&amp;H\nSlope:", round(coef(lm_after)[2], 2),</span></span>
<span id="cb27-1075"><a href="#cb27-1075" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_after)[1], 2),</span></span>
<span id="cb27-1076"><a href="#cb27-1076" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_after)$r.squared, 2)), </span></span>
<span id="cb27-1077"><a href="#cb27-1077" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3)</span></span>
<span id="cb27-1078"><a href="#cb27-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1079"><a href="#cb27-1079" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1080"><a href="#cb27-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1081"><a href="#cb27-1081" aria-hidden="true" tabindex="-1"></a><span class="fu">### Progress Disadvantaged All</span></span>
<span id="cb27-1082"><a href="#cb27-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1083"><a href="#cb27-1083" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-1084"><a href="#cb27-1084" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-1085"><a href="#cb27-1085" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-1086"><a href="#cb27-1086" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-1087"><a href="#cb27-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1088"><a href="#cb27-1088" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model for the entire data</span></span>
<span id="cb27-1089"><a href="#cb27-1089" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(P8MEA_FSM6CLA1A ~ PPERSABS10, data = england_school_2022_23_not_special)</span></span>
<span id="cb27-1090"><a href="#cb27-1090" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-1091"><a href="#cb27-1091" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-1092"><a href="#cb27-1092" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-1093"><a href="#cb27-1093" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-1094"><a href="#cb27-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1095"><a href="#cb27-1095" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-1096"><a href="#cb27-1096" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-1097"><a href="#cb27-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1098"><a href="#cb27-1098" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-1099"><a href="#cb27-1099" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = P8MEA_FSM6CLA1A, x = PPERSABS10)) +</span></span>
<span id="cb27-1100"><a href="#cb27-1100" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-1101"><a href="#cb27-1101" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = P8MEA_FSM6CLA1A, x = PPERSABS10, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-1102"><a href="#cb27-1102" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-1103"><a href="#cb27-1103" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-1104"><a href="#cb27-1104" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-1105"><a href="#cb27-1105" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Progress 8 Disadvantaged vs % School Percentage of \nPersistently Absent Students, 2022-23",</span></span>
<span id="cb27-1106"><a href="#cb27-1106" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Persistently Absent Students",</span></span>
<span id="cb27-1107"><a href="#cb27-1107" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Progress 8 measure",</span></span>
<span id="cb27-1108"><a href="#cb27-1108" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-1109"><a href="#cb27-1109" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-1110"><a href="#cb27-1110" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-1111"><a href="#cb27-1111" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(england_school_2022_23_not_special$P8MEA_FSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-1112"><a href="#cb27-1112" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 1, vjust = 0, size = 3)</span></span>
<span id="cb27-1113"><a href="#cb27-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1114"><a href="#cb27-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1115"><a href="#cb27-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1116"><a href="#cb27-1116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1117"><a href="#cb27-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1118"><a href="#cb27-1118" aria-hidden="true" tabindex="-1"></a><span class="fu">### Progress Disadvantaged B&amp;H Range</span></span>
<span id="cb27-1119"><a href="#cb27-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1120"><a href="#cb27-1120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-1121"><a href="#cb27-1121" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-1122"><a href="#cb27-1122" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-1123"><a href="#cb27-1123" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-1124"><a href="#cb27-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1125"><a href="#cb27-1125" aria-hidden="true" tabindex="-1"></a><span class="in"># Create the subset</span></span>
<span id="cb27-1126"><a href="#cb27-1126" aria-hidden="true" tabindex="-1"></a><span class="in">subset_data &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-1127"><a href="#cb27-1127" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &gt;= min_value &amp; PPERSABS10 &lt;= max_value)</span></span>
<span id="cb27-1128"><a href="#cb27-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1129"><a href="#cb27-1129" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the linear model</span></span>
<span id="cb27-1130"><a href="#cb27-1130" aria-hidden="true" tabindex="-1"></a><span class="in">lm_model &lt;- lm(P8MEA_FSM6CLA1A ~ PPERSABS10, data = subset_data)</span></span>
<span id="cb27-1131"><a href="#cb27-1131" aria-hidden="true" tabindex="-1"></a><span class="in">lm_summary &lt;- summary(lm_model)</span></span>
<span id="cb27-1132"><a href="#cb27-1132" aria-hidden="true" tabindex="-1"></a><span class="in">slope &lt;- lm_summary$coefficients[2, 1]</span></span>
<span id="cb27-1133"><a href="#cb27-1133" aria-hidden="true" tabindex="-1"></a><span class="in">intercept &lt;- lm_summary$coefficients[1, 1]</span></span>
<span id="cb27-1134"><a href="#cb27-1134" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- lm_summary$r.squared</span></span>
<span id="cb27-1135"><a href="#cb27-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1136"><a href="#cb27-1136" aria-hidden="true" tabindex="-1"></a><span class="in"># Annotation text</span></span>
<span id="cb27-1137"><a href="#cb27-1137" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_text &lt;- paste("Slope:", round(slope, 2), "\nIntercept:", round(intercept, 2), "\nR-squared:", round(r_squared, 2))</span></span>
<span id="cb27-1138"><a href="#cb27-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1139"><a href="#cb27-1139" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with a linear regression line and annotation</span></span>
<span id="cb27-1140"><a href="#cb27-1140" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(subset_data, aes(y = P8MEA_FSM6CLA1A, x = PPERSABS10)) +</span></span>
<span id="cb27-1141"><a href="#cb27-1141" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-1142"><a href="#cb27-1142" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = P8MEA_FSM6CLA1A, x = PPERSABS10, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-1143"><a href="#cb27-1143" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-1144"><a href="#cb27-1144" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-1145"><a href="#cb27-1145" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = TRUE, color = "red") +</span></span>
<span id="cb27-1146"><a href="#cb27-1146" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Progress 8 Disadvantaged vs % Percentage of \nPersistently Absent Students, 2022-23",</span></span>
<span id="cb27-1147"><a href="#cb27-1147" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "% Percentage of Persistently Absent Students",</span></span>
<span id="cb27-1148"><a href="#cb27-1148" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Progress 8 measure",</span></span>
<span id="cb27-1149"><a href="#cb27-1149" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-1150"><a href="#cb27-1150" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-1151"><a href="#cb27-1151" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-1152"><a href="#cb27-1152" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 80, y = min(subset_data$P8MEA_FSM6CLA1A, na.rm = TRUE), </span></span>
<span id="cb27-1153"><a href="#cb27-1153" aria-hidden="true" tabindex="-1"></a><span class="in">           label = annotation_text, hjust = 0.5, vjust = -1, size = 3)</span></span>
<span id="cb27-1154"><a href="#cb27-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1155"><a href="#cb27-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1156"><a href="#cb27-1156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1157"><a href="#cb27-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1158"><a href="#cb27-1158" aria-hidden="true" tabindex="-1"></a><span class="fu">### Progress Disadvantaged Mixed Ranges</span></span>
<span id="cb27-1159"><a href="#cb27-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1160"><a href="#cb27-1160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=T, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-1161"><a href="#cb27-1161" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the min and max values for the subset range</span></span>
<span id="cb27-1162"><a href="#cb27-1162" aria-hidden="true" tabindex="-1"></a><span class="in">min_value &lt;- min(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-1163"><a href="#cb27-1163" aria-hidden="true" tabindex="-1"></a><span class="in">max_value &lt;- max(btn_sub$PPERSABS10, na.rm = TRUE)</span></span>
<span id="cb27-1164"><a href="#cb27-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1165"><a href="#cb27-1165" aria-hidden="true" tabindex="-1"></a><span class="in"># Create subsets</span></span>
<span id="cb27-1166"><a href="#cb27-1166" aria-hidden="true" tabindex="-1"></a><span class="in">subset_before &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-1167"><a href="#cb27-1167" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &lt; min_value)</span></span>
<span id="cb27-1168"><a href="#cb27-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1169"><a href="#cb27-1169" aria-hidden="true" tabindex="-1"></a><span class="in">subset_after &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-1170"><a href="#cb27-1170" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &gt; max_value)</span></span>
<span id="cb27-1171"><a href="#cb27-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1172"><a href="#cb27-1172" aria-hidden="true" tabindex="-1"></a><span class="in">subset_within &lt;- england_school_2022_23_not_special %&gt;%</span></span>
<span id="cb27-1173"><a href="#cb27-1173" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(PPERSABS10 &gt;= min_value &amp; PPERSABS10 &lt;= max_value)</span></span>
<span id="cb27-1174"><a href="#cb27-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1175"><a href="#cb27-1175" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit linear models</span></span>
<span id="cb27-1176"><a href="#cb27-1176" aria-hidden="true" tabindex="-1"></a><span class="in">lm_before &lt;- lm(P8MEA_FSM6CLA1A ~ PPERSABS10, data = subset_before)</span></span>
<span id="cb27-1177"><a href="#cb27-1177" aria-hidden="true" tabindex="-1"></a><span class="in">lm_within &lt;- lm(P8MEA_FSM6CLA1A ~ PPERSABS10, data = subset_within)</span></span>
<span id="cb27-1178"><a href="#cb27-1178" aria-hidden="true" tabindex="-1"></a><span class="in">lm_after &lt;- lm(P8MEA_FSM6CLA1A ~ PPERSABS10, data = subset_after)</span></span>
<span id="cb27-1179"><a href="#cb27-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1180"><a href="#cb27-1180" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate middle x positions for annotations</span></span>
<span id="cb27-1181"><a href="#cb27-1181" aria-hidden="true" tabindex="-1"></a><span class="in">middle_before &lt;- mean(c(0, min_value))</span></span>
<span id="cb27-1182"><a href="#cb27-1182" aria-hidden="true" tabindex="-1"></a><span class="in">middle_within &lt;- mean(c(min_value, max_value))</span></span>
<span id="cb27-1183"><a href="#cb27-1183" aria-hidden="true" tabindex="-1"></a><span class="in">middle_after &lt;- mean(c(max_value, 100))</span></span>
<span id="cb27-1184"><a href="#cb27-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1185"><a href="#cb27-1185" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with annotations</span></span>
<span id="cb27-1186"><a href="#cb27-1186" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(england_school_2022_23_not_special, aes(y = P8MEA_FSM6CLA1A, x = PPERSABS10)) +</span></span>
<span id="cb27-1187"><a href="#cb27-1187" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb27-1188"><a href="#cb27-1188" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = btn_sub, aes(y = P8MEA_FSM6CLA1A, x = PPERSABS10, colour = OFSTEDRATING)) +</span></span>
<span id="cb27-1189"><a href="#cb27-1189" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = min_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-1190"><a href="#cb27-1190" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = max_value, linetype = "dashed", color = "blue") +</span></span>
<span id="cb27-1191"><a href="#cb27-1191" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_before, method = "lm", se = TRUE, color = "red", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-1192"><a href="#cb27-1192" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_within, method = "lm", se = TRUE, color = "green", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-1193"><a href="#cb27-1193" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(data = subset_after, method = "lm", se = TRUE, color = "purple", linetype = "solid", aes(group = 1)) +</span></span>
<span id="cb27-1194"><a href="#cb27-1194" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Progress 8 Disadvantaged vs % Percentage of \nPersistently Absent Students, 2022-23",</span></span>
<span id="cb27-1195"><a href="#cb27-1195" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "School % Percentage of Persistently Absent Students",</span></span>
<span id="cb27-1196"><a href="#cb27-1196" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Progress 8 measure",</span></span>
<span id="cb27-1197"><a href="#cb27-1197" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "B&amp;H Schools \nOfsted Rating") +</span></span>
<span id="cb27-1198"><a href="#cb27-1198" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb27-1199"><a href="#cb27-1199" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 100) +</span></span>
<span id="cb27-1200"><a href="#cb27-1200" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_before, y = min(subset_before$P8MEA_FSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-1201"><a href="#cb27-1201" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Lower B&amp;H\nSlope:", round(coef(lm_before)[2], 2),</span></span>
<span id="cb27-1202"><a href="#cb27-1202" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_before)[1], 2),</span></span>
<span id="cb27-1203"><a href="#cb27-1203" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_before)$r.squared, 2)), </span></span>
<span id="cb27-1204"><a href="#cb27-1204" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3) +</span></span>
<span id="cb27-1205"><a href="#cb27-1205" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_within, y = min(subset_within$P8MEA_FSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-1206"><a href="#cb27-1206" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("B&amp;H P-Abs Range\nSlope:", round(coef(lm_within)[2], 2),</span></span>
<span id="cb27-1207"><a href="#cb27-1207" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_within)[1], 2),</span></span>
<span id="cb27-1208"><a href="#cb27-1208" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_within)$r.squared, 2)), </span></span>
<span id="cb27-1209"><a href="#cb27-1209" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 0.5, size = 3) +</span></span>
<span id="cb27-1210"><a href="#cb27-1210" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = middle_after, y = min(subset_after$P8MEA_FSM6CLA1A, na.rm = TRUE) + 5, </span></span>
<span id="cb27-1211"><a href="#cb27-1211" aria-hidden="true" tabindex="-1"></a><span class="in">           label = paste("Higher B&amp;H\nSlope:", round(coef(lm_after)[2], 2),</span></span>
<span id="cb27-1212"><a href="#cb27-1212" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nIntercept:", round(coef(lm_after)[1], 2),</span></span>
<span id="cb27-1213"><a href="#cb27-1213" aria-hidden="true" tabindex="-1"></a><span class="in">                         "\nR-squared:", round(summary(lm_after)$r.squared, 2)), </span></span>
<span id="cb27-1214"><a href="#cb27-1214" aria-hidden="true" tabindex="-1"></a><span class="in">           hjust = 0.5, vjust = 1, size = 3)</span></span>
<span id="cb27-1215"><a href="#cb27-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1216"><a href="#cb27-1216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/adamdennett/BH_Schools_Consultation/blob/main/attainment_extra.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/adamdennett/BH_Schools_Consultation/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>