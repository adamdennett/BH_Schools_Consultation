<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Adam Dennett">

<title>Brighton and Hove Secondary Schools Consultation - Fact Sheet</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="consultation_factsheet_files/libs/clipboard/clipboard.min.js"></script>
<script src="consultation_factsheet_files/libs/quarto-html/quarto.js"></script>
<script src="consultation_factsheet_files/libs/quarto-html/popper.min.js"></script>
<script src="consultation_factsheet_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="consultation_factsheet_files/libs/quarto-html/anchor.min.js"></script>
<link href="consultation_factsheet_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="consultation_factsheet_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="consultation_factsheet_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="consultation_factsheet_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="consultation_factsheet_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Brighton and Hove Secondary Schools Consultation - Fact Sheet</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Adam Dennett </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p><img src="images/fact_check.jpeg" class="img-fluid"></p>
<section id="premise-1---attainment-gap" class="level2">
<h2 class="anchored" data-anchor-id="premise-1---attainment-gap">Premise 1 - Attainment Gap</h2>
<p>BHCC Premise - Brighton and Hove has an attainment gap that needs narrowing. It has below average attainment for disadvantaged students.</p>
<p>On attainment of disadvantaged students - <strong>False</strong>. On the gap - <strong>True</strong>, it exists and is relatively large, but because non-disadvantaged students are very high achievers.</p>
</section>
<section id="fact-1---attainment-gap" class="level2">
<h2 class="anchored" data-anchor-id="fact-1---attainment-gap">Fact 1 - Attainment Gap</h2>
<p>In 2024, all students in Brighton and Hove - both disadvantaged and non-disadvantaged - achieved <strong><em>ABOVE</em></strong> the national (median) average when compared to other Local Education Authorities in England.</p>
<p>There is an attainment gap between disadvantaged and non-disadvantaged pupils in every Local Authority in England. Brighton’s is relatively large in absolute terms but is an artifact of non-disadvantaged students doing far better than average.</p>
<p><img src="images/attainmentgap_95.png" class="img-fluid"></p>
<p><a href="https://adamdennett.github.io/BH_Schools_2/stain_removal.html#disadvantaged-vs-non-disadvantaged-pupils" class="uri">https://adamdennett.github.io/BH_Schools_2/stain_removal.html#disadvantaged-vs-non-disadvantaged-pupils</a></p>
</section>
<section id="premise-2---drivers-of-attainment" class="level2">
<h2 class="anchored" data-anchor-id="premise-2---drivers-of-attainment">Premise 2 - Drivers of Attainment</h2>
<p>BHCC Premise - economic advantage/disadvantage are the main drivers of results in the city</p>
<blockquote class="blockquote">
<p>BHCC School Admission Arrangements 2026-27 - 3.9 “Better equality of outcomes – results not driven by economic advantage.”</p>
</blockquote>
<p><strong>False</strong></p>
<p>Economic advantage/disadvantage is not the main driver of results in the city.</p>
</section>
<section id="fact-2a---what-prof-stephen-gorard-actually-says-in-the-paper-underpinning-all-of-the-councils-claims" class="level2">
<h2 class="anchored" data-anchor-id="fact-2a---what-prof-stephen-gorard-actually-says-in-the-paper-underpinning-all-of-the-councils-claims">Fact 2a - What Prof Stephen Gorard actually says in the paper underpinning all of the council’s claims</h2>
<p>Full paper here - <a href="https://journals.sagepub.com/doi/full/10.1177/2158244018825171" class="uri">https://journals.sagepub.com/doi/full/10.1177/2158244018825171</a></p>
<blockquote class="blockquote">
<p>“Whether school composition is a phantom or not, the school-level variables tell a consistent story across the duration of schooling. Pupils do worse in schools with clusters of disadvantage or clusters of prior attainment. Put another way, if this composition is real, then schools should be as mixed as possible both socially and academically. <strong><em>This could lead to improved outcomes of between 0.05 and 0.15 of a standard deviation</em></strong> for almost no cost.”</p>
</blockquote>
<p>Interpretation</p>
<ul>
<li><p>In 2022-23 the mean school - level <a href="https://www.ethnicity-facts-figures.service.gov.uk/education-skills-and-training/11-to-16-years-old/gcse-results-attainment-8-for-children-aged-14-to-16-key-stage-4/latest/">Attainment 8</a> score in Brighton was 47.56 (in England it was 45.9). The standard deviation was 6.92 (in England, 7.23).</p></li>
<li><p>0.15 of of 6.92 = 1.038 point improvement. 0.05 = 0.35 pt improvement.</p></li>
<li><p>For an undetermined additional level of mixing in schools, if the effect is not a ‘phantom’, the maximum improvement (if no costs involved in achieving additional mixing) we might expect for an average student is a 1pt improvement across equivalent 10 GCSEs taken. e.g moving from a C to a B in Maths or an E to a D in French, only.</p></li>
</ul>
</section>
<section id="fact-2b---drivers-of-attainment" class="level2">
<h2 class="anchored" data-anchor-id="fact-2b---drivers-of-attainment">Fact 2b - Drivers of Attainment</h2>
<p>But for Brighton, Gorard’s effects might not even be valid. Examining state secondary schools in England experiencing the same concentrations of disadvantage as those in Brighton and Hove, there is NO RELATIONSHIP between variations in levels of disadvantage and levels of attainment or progress.</p>
<p><img src="images/Attainment8_disadvantage.png" class="img-fluid"></p>
<p><img src="images/Progress8_disadvantage.png" class="img-fluid"></p>
<p>https://adamdennett.github.io/BH_Schools_Consultation/attainment_extra.html</p>
</section>
<section id="fact-2c---drivers-of-attainment" class="level2">
<h2 class="anchored" data-anchor-id="fact-2c---drivers-of-attainment">Fact 2c - Drivers of Attainment</h2>
<p>Far more important as a driver of attainment in Brighton (and in other secondary schools in England) is persistent absence. There is a strong negative correlation between persistent absence and both Attainment 8 and Progress 8 scores nationally and in Brighton and Hove.</p>
<p><img src="images/progress8_vs_persabs.png" class="img-fluid"></p>
</section>
<section id="fact-2c---what-prof-stephen-gorard-actually-says-in-the-paper-underpinning-all-of-the-councils-claims" class="level2">
<h2 class="anchored" data-anchor-id="fact-2c---what-prof-stephen-gorard-actually-says-in-the-paper-underpinning-all-of-the-councils-claims">Fact 2c - What Prof Stephen Gorard actually says in the paper underpinning all of the council’s claims</h2>
<p>Full paper here - <a href="https://journals.sagepub.com/doi/full/10.1177/2158244018825171" class="uri">https://journals.sagepub.com/doi/full/10.1177/2158244018825171</a></p>
<blockquote class="blockquote">
<p>“Whether school composition is a phantom or not, the school-level variables tell a consistent story across the duration of schooling. Pupils do worse in schools with clusters of disadvantage or clusters of prior attainment. Put another way, if this composition is real, then schools should be as mixed as possible both socially and academically. <strong><em>This could lead to improved outcomes of between 0.05 and 0.15 of a standard deviation</em></strong> for almost no cost.”</p>
</blockquote>
<p>Interpretation</p>
<ul>
<li><p>In 2022-23 the mean school - level <a href="https://www.ethnicity-facts-figures.service.gov.uk/education-skills-and-training/11-to-16-years-old/gcse-results-attainment-8-for-children-aged-14-to-16-key-stage-4/latest/">Attainment 8</a> score in Brighton was 47.56 (in England it was 45.9). The standard deviation was 6.92 (in England, 7.23).</p></li>
<li><p>0.15 of of 6.92 = 1.038 point improvement. 0.05 = 0.35 pt improvement.</p></li>
<li><p>For an undetermined additional level of mixing in schools, if the effect is not a ‘phantom’, the maximum improvement (if no costs involved in achieving additional mixing) we might expect for an average student is a 1pt improvement across equivalent 10 GCSEs taken. e.g moving from a C to a B in Maths.</p></li>
</ul>
</section>
<section id="premise-3---geographic-spread-of-schools" class="level2">
<h2 class="anchored" data-anchor-id="premise-3---geographic-spread-of-schools">Premise 3 - Geographic Spread of Schools</h2>
<p>BHCC Premise - Brighton and Hove should maintain the geographic spread of secondary schools in the city</p>
<blockquote class="blockquote">
<p>BHCC School Admission Arrangements 2026-27 - 3.9 “Maintaining the geographic spread of secondary schools in the city”</p>
</blockquote>
<p><strong>Debatable</strong></p>
<p>This is a party political desire to keep the current configuration of schools. The current geographic spread of schools relative to the city’s population is in part causing the viability issues for Longhill. Trying to keep a large Longhill in its current location is likely what is driving proposed PAN reductions at popular, oversubscribed schools elsewhere in the city.</p>
</section>
<section id="fact-3" class="level2">
<h2 class="anchored" data-anchor-id="fact-3">Fact 3</h2>
<p>Demand for schools varies significantly across the city. At the lower end, in the last 11-years, Longhill has received fewer <strong><em>total applications</em></strong> (1st, 2nd and 3rd choice combined) than its Published Admission Number (PAN) of 270. In-demand schools would normally expect considerably more <em>total applications</em> than places available as 2nd and 3rd choices are often allocated places elsewhere. For comparison, another single catchment school - Patcham High, has generally received around <strong><em>twice as many</em></strong> total applications than PAN.</p>
<p>Over the last 11 years (since 2013), Longhill’s total offers have trended down every year, and it has never achieved anywhere near 270 offers. It’s peak was in 2014 when it made 209 offers. Last year it made 94 offers.</p>
<p><img src="images/yearly_offers_sml.png" class="img-fluid"></p>
<p><a href="https://adamdennett.github.io/BH_Schools_2/schools_wk2.html#school-application-and-offer-history-across-brighton" class="uri">https://adamdennett.github.io/BH_Schools_2/schools_wk2.html#school-application-and-offer-history-across-brighton</a></p>
<p>Longhill’s challenges are multiple, but two stick out:</p>
<ul>
<li><p>it is geographically remote</p></li>
<li><p>as a school with the capacity to admit 270 pupils a year, its site is far too large relative to the numbers of students it has attracted in recent years and will likely attract in the future if the trend continues the 10 year trajectory.</p></li>
</ul>
<p><img src="images/map_11_year_olds_2024.png" class="img-fluid"></p>
<p>Modelling I <a href="https://adamdennett.github.io/BH_Schools_2/schools_wk3.html">carried out here</a> suggests that if Longhill were moved further west to somewhere near the Race Course, it would be far more attractive to students - all other things being equal.</p>
</section>
<section id="premise-4---social-mixing-in-schools-and-attainment" class="level2">
<h2 class="anchored" data-anchor-id="premise-4---social-mixing-in-schools-and-attainment">Premise 4 - Social Mixing in Schools and Attainment</h2>
<p>BHCC Premise - Brighton and Hove’s schools are not mixed enough and increasing mixing (by any means) will create better outcomes for disadvantaged pupils.</p>
<blockquote class="blockquote">
<p>BHCC School Admission Arrangements 2026-27 - 3.9 “Deliver a ‘comprehensive’ offer from our city schools as a more mixed pupil intake creates better outcomes for disadvantaged pupils.”</p>
</blockquote>
<p><strong>Conflicting evidence</strong>, but Brighton specific analysis suggests increasing mixing will not benefit disadvantaged students in the city.</p>
</section>
<section id="fact-4" class="level2">
<h2 class="anchored" data-anchor-id="fact-4">Fact 4</h2>
<p>Brighton and Hove’s schools are already very mixed (relative to other LEAs in England) according to the relative proportions of disadvantaged and non-disadvantaged pupils across state secondary schools in the whole city.</p>
<p>Stephen Gorard (yes him again!) proposed an Index that some called the ‘Gorard Segregation Index’ which can be used to examine segregation of disadvantaged and non-disadvantaged students in schools. The formula for calculating it is here - <a href="https://sru.soc.surrey.ac.uk/SRU30.html" class="uri">https://sru.soc.surrey.ac.uk/SRU30.html</a></p>
<p>The plot below shows where Brighton sits relative to other LEAs in England on both the Gorard Segregation Index (for disadvantage) and a more standard dissimilarity index for the same variables. 0 = total integration of disadvantaged and non-disadvantaged students, 1 = total segregation. Brighton and Hove has a Gordard Segregation Index score of 0.13 - ranking it 44th BEST in the country for integration. 110 LEAs have schools which are more segregated.</p>
<p><img src="images/segregation_plot.png" class="img-fluid"></p>
</section>
<section id="premise-5---greater-access-to-a-range-of-schools" class="level2">
<h2 class="anchored" data-anchor-id="premise-5---greater-access-to-a-range-of-schools">Premise 5 - Greater Access to a Range of Schools</h2>
<p>Choice</p>
</section>
<section id="fact-5" class="level2">
<h2 class="anchored" data-anchor-id="fact-5">Fact 5</h2>
</section>
<section id="premise-6---fairness" class="level2">
<h2 class="anchored" data-anchor-id="premise-6---fairness">Premise 6 - Fairness</h2>
</section>
<section id="premise-7---academic-evidence-to-support-the-councils-approach" class="level2">
<h2 class="anchored" data-anchor-id="premise-7---academic-evidence-to-support-the-councils-approach">Premise 7 - Academic Evidence to Support the Council’s Approach</h2>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>